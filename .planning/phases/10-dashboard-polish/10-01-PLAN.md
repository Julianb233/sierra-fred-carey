# Plan: 10-01 — Monitoring Dashboard Fixes

**Phase:** 10 - Dashboard Polish & Missing Wiring
**Audit Ref:** v1.0-final-audit-2026-02-06.md — GAP 1
**File:** `app/dashboard/monitoring/page.tsx`

---

## Problem

4 non-functional elements on the monitoring dashboard page:

1. **"View Details" button** (line 321) — No onClick handler; should switch to Alerts tab
2. **CSV export** (line 174-178) — Shows `alert()` placeholder instead of real export
3. **JSON export** (line 181-185) — Shows `alert()` placeholder instead of real export
4. **Filter handler** (line 167-171) — Updates state but doesn't re-fetch data

---

## Tasks

### Task 1: Wire "View Details" button to Alerts tab

**File:** `app/dashboard/monitoring/page.tsx`

- Convert the `Tabs` `defaultValue` to controlled state: add `const [activeTab, setActiveTab] = useState("experiments")`
- Pass `value={activeTab}` and `onValueChange={setActiveTab}` to `<Tabs>`
- Add `onClick={() => setActiveTab("alerts")}` to the "View Details" button (line 321)

### Task 2: Implement CSV export

**File:** `app/dashboard/monitoring/page.tsx`

Replace the `handleExportCSV` function body with real CSV generation:

```typescript
const handleExportCSV = () => {
  const rows = [
    ["Experiment", "Status", "Variants", "Total Requests", "Avg Latency", "Error Rate"],
    ...experiments.map(exp => [
      exp.name,
      exp.isActive ? "Active" : "Ended",
      String(exp.variantCount ?? 0),
      String(exp.totalRequests ?? 0),
      String(exp.avgLatency ?? 0),
      String(exp.errorRate ?? 0),
    ]),
  ];
  const csv = rows.map(r => r.map(c => `"${c}"`).join(",")).join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `monitoring-export-${new Date().toISOString().slice(0, 10)}.csv`;
  a.click();
  URL.revokeObjectURL(url);
};
```

### Task 3: Implement JSON export

Replace the `handleExportJSON` function body:

```typescript
const handleExportJSON = () => {
  const data = {
    exportedAt: new Date().toISOString(),
    filters,
    metrics: { totalRequests, avgLatency, errorRate, activeExperimentCount },
    experiments,
    alerts,
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `monitoring-export-${new Date().toISOString().slice(0, 10)}.json`;
  a.click();
  URL.revokeObjectURL(url);
};
```

### Task 4: Wire filter handler to re-fetch

Replace the `handleFilterChange` function body:

```typescript
const handleFilterChange = (newFilters: FilterState) => {
  setFilters(newFilters);
  fetchDashboardData();
  fetchAlerts();
};
```

### Task 5: Remove stale TODO from invite endpoint

**File:** `app/api/onboard/invite/route.ts`

The rate limiting TODO comment is stale — rate limiting is already implemented on lines 12-20. Remove the comment if it still exists (check line 1-10 area for any `// TODO` about rate limiting).

---

## Verification

- [ ] "View Details" button switches to Alerts tab on click
- [ ] CSV export downloads a real .csv file with experiment data
- [ ] JSON export downloads a real .json file with all dashboard state
- [ ] Changing filters triggers data re-fetch
- [ ] No `alert()` calls remain in the monitoring page
- [ ] `tsc --noEmit` passes
