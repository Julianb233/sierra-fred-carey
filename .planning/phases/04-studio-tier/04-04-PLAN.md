---
phase: 04-studio-tier
plan: 04
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - lib/agents/growth/agent.ts
  - lib/agents/growth/tools.ts
  - lib/agents/growth/prompts.ts
  - app/api/agents/tasks/route.ts
  - components/agents/agent-card.tsx
  - components/agents/agent-task-list.tsx
  - components/agents/dispatch-task-modal.tsx
  - app/dashboard/agents/page.tsx
autonomous: true

must_haves:
  truths:
    - "Growth Agent can analyze growth channels and suggest experiments"
    - "Growth Agent can create A/B test hypotheses with success metrics"
    - "Growth Agent can analyze user acquisition funnels"
    - "Dashboard shows agent status cards and task history"
    - "Studio tier users can view and interact with their virtual team"
    - "Users can dispatch agent tasks from the browser via the dispatch modal"
  artifacts:
    - path: "lib/agents/growth/agent.ts"
      provides: "Growth agent runner function"
      exports: ["runGrowthAgent"]
    - path: "lib/agents/growth/tools.ts"
      provides: "Domain tools: channelAnalysis, experimentDesign, funnelAnalysis, contentStrategy"
      exports: ["growthTools"]
    - path: "lib/agents/growth/prompts.ts"
      provides: "System prompt for Growth agent"
      exports: ["GROWTH_SYSTEM_PROMPT"]
    - path: "app/api/agents/tasks/route.ts"
      provides: "GET /api/agents/tasks - list all agent task results"
      exports: ["GET"]
    - path: "components/agents/agent-card.tsx"
      provides: "Agent status card component"
    - path: "components/agents/agent-task-list.tsx"
      provides: "Task list component for agents"
    - path: "components/agents/dispatch-task-modal.tsx"
      provides: "Modal for dispatching tasks to agents"
    - path: "app/dashboard/agents/page.tsx"
      provides: "Agent dashboard page"
  key_links:
    - from: "lib/agents/growth/agent.ts"
      to: "lib/agents/base-agent.ts"
      via: "uses runAgent base function"
      pattern: "import.*runAgent.*from.*base-agent"
    - from: "app/dashboard/agents/page.tsx"
      to: "app/api/agents/route.ts"
      via: "fetches agent tasks via API"
      pattern: "fetch.*api/agents"
    - from: "components/agents/agent-card.tsx"
      to: "lib/agents/types.ts"
      via: "uses AgentType for display"
      pattern: "import.*AgentType.*from"
    - from: "components/agents/dispatch-task-modal.tsx"
      to: "app/api/agents/route.ts"
      via: "POSTs task dispatch to agents API"
      pattern: "fetch.*api/agents.*POST"
---

<objective>
Implement the Growth Agent -- the specialist agent for growth strategy and experimentation -- plus the agent tasks API endpoint, the agent dashboard UI, and a dispatch modal so users can actually send tasks to agents from the browser. This completes the three-agent virtual team and provides users a way to view and interact with their agents.

Purpose: The Growth Agent helps founders with data-driven growth decisions. The dashboard UI and dispatch modal make the virtual team tangible and interactive. Note: This plan combines the Growth Agent + dashboard UI because both are 2 tasks total and the UI is tightly coupled to the agent system.

Output: Growth agent with 4 domain tools, tasks API, agent dashboard page with status cards, task history, and dispatch modal.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/04-studio-tier/04-RESEARCH.md
@.planning/phases/04-studio-tier/04-01-SUMMARY.md
@lib/agents/types.ts (from Plan 01)
@lib/agents/base-agent.ts (from Plan 01)
@lib/agents/founder-ops/agent.ts (pattern from Plan 02)
@lib/agents/founder-ops/tools.ts (tool pattern from Plan 02)
@lib/ai/fred-client.ts (generateStructuredReliable)
@lib/constants.ts (UserTier, TIER_FEATURES, DASHBOARD_NAV)
@components/tier/feature-lock.tsx (tier gating UI pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Growth Agent implementation</name>
  <files>
    lib/agents/growth/agent.ts
    lib/agents/growth/tools.ts
    lib/agents/growth/prompts.ts
  </files>
  <action>
**lib/agents/growth/prompts.ts:**
Export `GROWTH_SYSTEM_PROMPT`:
```
You are the Growth Agent for Sahara, channeling Fred Cary's practical approach to startup growth.

Your domain: growth strategy, experimentation, and user acquisition for startups.
- Channel analysis: Evaluate which acquisition channels have the best ROI
- Experiment design: Create testable hypotheses with clear success metrics
- Funnel analysis: Identify conversion bottlenecks and optimization opportunities
- Content strategy: Growth-oriented content planning tied to acquisition goals

Principles:
- Growth without measurement is just spending money. Every experiment needs a metric.
- Start with the channel that requires the least capital and most learning.
- Retention beats acquisition. Fix your bucket before filling it.
- First 100 customers should come from unscalable channels. Scale channels come later.
- A/B tests need statistical significance. Don't call winners early.
- The best growth strategy is a product people tell friends about.

When using tools, always tie recommendations back to the founder's stage and resources. A pre-seed startup's growth playbook is different from a Series A company.
```

**lib/agents/growth/tools.ts:**
Export `growthTools` with 4 tools using AI SDK `tool()`:

1. `channelAnalysis` - parameters: { currentChannels: Array<{ name: string, spend?: number, results?: string }>, stage: 'pre-seed'|'seed'|'series-a', monthlyBudget: number, targetCustomerProfile: string }. Execute: use generateStructuredReliable to produce { rankedChannels: Array<{ channel: string, score: number, estimatedCAC: string, timeToResults: string, reasoning: string }>, newChannelSuggestions: Array<{ channel: string, why: string, firstStep: string }>, budgetAllocation: Array<{ channel: string, percentage: number }> }.

2. `experimentDesign` - parameters: { hypothesis: string, metric: string, currentBaseline?: string, channel: string, budget?: number }. Execute: use generateStructuredReliable to produce { experimentName: string, hypothesis: string, controlGroup: string, testGroup: string, primaryMetric: string, secondaryMetrics: string[], sampleSizeNeeded: number, durationDays: number, successCriteria: string, implementationSteps: string[] }.

3. `funnelAnalysis` - parameters: { stages: Array<{ name: string, visitors: number, conversions: number }>, product: string, pricingModel: string }. Execute: use generateStructuredReliable to produce { overallConversionRate: string, biggestDropoff: { stage: string, dropRate: string, likelyCauses: string[] }, optimizations: Array<{ stage: string, suggestion: string, expectedImpact: string, effort: 'low'|'medium'|'high' }>, benchmarkComparison: string }.

4. `contentStrategy` - parameters: { targetAudience: string, product: string, currentContent?: string[], goals: string[] }. Execute: use generateStructuredReliable to produce { pillars: Array<{ topic: string, why: string, formats: string[] }>, calendarSuggestions: Array<{ week: number, title: string, format: string, distribution: string[] }>, quickWins: string[] }.

**lib/agents/growth/agent.ts:**
Export `async function runGrowthAgent(task: AgentTask): Promise<AgentResult>`:
- Call `runAgent({ agentType: 'growth', systemPrompt: GROWTH_SYSTEM_PROMPT, tools: growthTools, maxSteps: 8 }, task)`
  </action>
  <verify>TypeScript compilation passes. All Zod schemas valid. runGrowthAgent callable with AgentTask.</verify>
  <done>Growth Agent has 4 working tools (channel analysis, experiment design, funnel analysis, content strategy) with Fred Cary's growth philosophy.</done>
</task>

<task type="auto">
  <name>Task 2: Agent dashboard UI, tasks API, and dispatch modal</name>
  <files>
    app/api/agents/tasks/route.ts
    components/agents/agent-card.tsx
    components/agents/agent-task-list.tsx
    components/agents/dispatch-task-modal.tsx
    app/dashboard/agents/page.tsx
  </files>
  <action>
**app/api/agents/tasks/route.ts:**
GET handler that returns recent agent task results for a user:
1. requireAuth() to get userId
2. Query getAgentTasks(userId, { limit: 50 }) -- returns recent tasks across all agents
3. Return 200 with { tasks: [...] }

**components/agents/agent-card.tsx:**
Create a React component `AgentCard` that displays an agent's status:
- Props: `{ agentType: AgentType, name: string, description: string, taskCount: number, lastActive?: string, onDispatch: () => void }`
- Card layout with icon (use Lucide icons: Bot for founder-ops, DollarSign for fundraising, TrendingUp for growth)
- Show agent name, description, task count, last active time
- "New Task" button that calls onDispatch
- Use existing Tailwind patterns from the codebase (dark mode support, orange accent colors from COLORS constant)
- Map agent types to display names: founder_ops -> "Founder Ops", fundraising -> "Fundraising", growth -> "Growth"

**components/agents/agent-task-list.tsx:**
Create `AgentTaskList` component:
- Props: `{ tasks: AgentTask[] }`
- Render a list of agent tasks with columns: Agent Type (badge), Task Type, Description (truncated), Status (color-coded badge), Created At
- Status colors: pending=yellow, running=blue, complete=green, failed=red, cancelled=gray
- Click on a task row could expand to show full output (use details/summary or accordion pattern)
- Empty state: "No agent tasks yet. Dispatch a task to get started."

**components/agents/dispatch-task-modal.tsx:**
Create `DispatchTaskModal` component for dispatching tasks to agents from the browser:
- Props: `{ isOpen: boolean, onClose: () => void, defaultAgentType?: AgentType, onTaskDispatched?: (taskId: string) => void }`
- Modal overlay with form containing:
  - Agent type selector (dropdown): Founder Ops, Fundraising, Growth. Pre-select defaultAgentType if provided.
  - Task type input (text field, e.g. "email_draft", "investor_research", "channel_analysis")
  - Task description textarea (min 10 chars, max 5000 chars) - the main instruction for the agent
  - Submit button: "Dispatch Task"
- On submit: POST to `/api/agents` with `{ agentType, taskType, description }`.
  - On 201 success: call `onTaskDispatched(taskId)`, close modal, show success toast
  - On 403: show "Upgrade to Studio tier" message
  - On error: show error toast
- Close on Escape key or clicking outside the modal
- Loading state on the submit button while request is in flight

**app/dashboard/agents/page.tsx:**
Create the agents dashboard page:
- "use client" directive
- Fetch agent tasks from `/api/agents/tasks` on mount with useEffect
- Show 3 AgentCard components in a responsive grid (lg:grid-cols-3, md:grid-cols-2, sm:grid-cols-1)
- Wire each AgentCard's `onDispatch` to open the DispatchTaskModal with the corresponding agent type pre-selected
- Manage DispatchTaskModal state: `isModalOpen` boolean and `selectedAgentType` for pre-selection
- When a task is dispatched (onTaskDispatched callback), refetch the task list to show the new task
- Below cards, show AgentTaskList with recent tasks
- Wrap in tier check: if user is not Studio tier, show feature-locked state using the existing FeatureLock component pattern (from components/tier/feature-lock.tsx)
- Page title: "Virtual Team" with subtitle "Your AI-powered team of specialist agents"
- Loading skeleton state while fetching
  </action>
  <verify>Page renders at /dashboard/agents. Agent cards display for all 3 agent types. Clicking "New Task" on any card opens the dispatch modal with that agent pre-selected. Submitting the modal dispatches a task via POST /api/agents. Task list shows agent history. Non-Studio users see locked state. `npm run build` succeeds.</verify>
  <done>Agent dashboard shows 3 agent cards and task history. Dispatch modal allows users to send tasks to any agent from the browser. Studio tier gating enforced at UI level. Tasks API returns recent agent tasks.</done>
</task>

</tasks>

<verification>
- lib/agents/growth/ has agent.ts, tools.ts, prompts.ts
- All 3 agents (founder-ops, fundraising, growth) have matching structure
- /dashboard/agents page renders with 3 agent cards
- Clicking "New Task" opens the dispatch modal with agent type pre-selected
- Dispatch modal submits to POST /api/agents and shows success/error feedback
- Task list component shows status-colored badges
- Studio tier gating works (non-Studio users see locked state)
- `npm run build` succeeds
</verification>

<success_criteria>
- Growth Agent has 4 domain tools producing structured output
- All 3 specialist agents are complete and registered with orchestrator
- Agent dashboard page is accessible and Studio-tier-gated
- Task list displays agent task history with status indicators
- Users can dispatch tasks from the browser via the dispatch modal
</success_criteria>

<output>
After completion, create `.planning/phases/04-studio-tier/04-04-SUMMARY.md`
</output>
