---
phase: 65-mobile-ux-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - app/layout.tsx
  - tests/e2e/accessibility-authenticated.spec.ts
autonomous: true

must_haves:
  truths:
    - "All core dashboard pages pass axe-core critical/serious WCAG 2.1 AA checks"
    - "Skip-to-content link is present on every page"
    - "a11y test suite covers all 15+ authenticated dashboard pages"
  artifacts:
    - path: "app/layout.tsx"
      provides: "Root layout with skip-to-content link and main landmark"
      contains: "Skip to main content"
    - path: "tests/e2e/accessibility-authenticated.spec.ts"
      provides: "Expanded a11y test covering all dashboard pages"
      min_lines: 40
  key_links:
    - from: "app/layout.tsx"
      to: "#main-content"
      via: "skip link href"
      pattern: "href.*#main-content"
    - from: "tests/e2e/accessibility-authenticated.spec.ts"
      to: "@axe-core/playwright"
      via: "AxeBuilder import"
      pattern: "AxeBuilder"
---

<objective>
Fix WCAG 2.1 AA compliance issues across all core pages and expand automated accessibility test coverage to catch regressions. The current a11y test suite only covers 5 authenticated pages -- expand to all 15+ dashboard pages.

Purpose: WCAG 2.1 AA compliance is a Phase 65 success criterion. The dashboard pages have sparse aria attributes and missing accessibility landmarks. Automated tests prevent regressions.

Output: Updated `app/layout.tsx` with skip-to-content link and main landmark, WCAG fixes across dashboard pages, expanded accessibility test suite.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/65-mobile-ux-polish/65-RESEARCH.md

Key existing files:
@app/layout.tsx
@app/dashboard/layout.tsx
@tests/e2e/accessibility-authenticated.spec.ts
@tests/e2e/accessibility.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add skip-to-content link and main landmark to root layout</name>
  <files>app/layout.tsx, app/dashboard/layout.tsx</files>
  <action>
1. **app/layout.tsx**: Add a skip-to-content link as the FIRST child of `<body>`:
   ```tsx
   <a
     href="#main-content"
     className="sr-only focus:not-sr-only focus:absolute focus:z-50 focus:p-4 focus:bg-white focus:text-black dark:focus:bg-gray-900 dark:focus:text-white focus:rounded-md focus:shadow-lg focus:top-4 focus:left-4"
   >
     Skip to main content
   </a>
   ```
   Place this BEFORE `<Script>` and `<Providers>`.

2. **app/dashboard/layout.tsx**: Add `id="main-content"` to the `<main>` element:
   - Change `<main className="flex-1 overflow-y-auto">` to `<main id="main-content" className="flex-1 overflow-y-auto">`
   - Also add `role="main"` for older assistive tech compatibility

3. Also add `<nav aria-label="Main navigation">` to the sidebar `<nav>` element in `app/dashboard/layout.tsx`:
   - The desktop sidebar nav (inside `SidebarContent`) currently has `<nav className="flex-1 overflow-y-auto p-4 space-y-1">` -- add `aria-label="Main navigation"` to it

4. Review the sidebar section labels ("Investor Tools", "Studio") -- these `<p>` elements should use `aria-hidden="true"` since they are decorative labels, or better, convert them to `<h3 className="px-3 pt-4 pb-1 text-[10px] font-semibold uppercase tracking-wider text-gray-400 dark:text-gray-500">` for semantic heading hierarchy within the nav.

5. Ensure the loading spinner has an accessible label:
   - The auth-checking spinner (`<div className="animate-spin ...">`) should have `role="status"` and `aria-label="Loading"` and include a `<span className="sr-only">Loading...</span>` inside it.
  </action>
  <verify>
- `app/layout.tsx` contains "Skip to main content" link
- `app/dashboard/layout.tsx` main element has id="main-content"
- sidebar nav has aria-label
- Loading spinner has role="status"
- `npm run build` succeeds
  </verify>
  <done>Root layout and dashboard layout have proper WCAG landmarks, skip navigation, and aria labels</done>
</task>

<task type="auto">
  <name>Task 2: Expand accessibility test coverage to all dashboard pages</name>
  <files>tests/e2e/accessibility-authenticated.spec.ts</files>
  <action>
1. Expand the `authenticatedPages` array to include all core dashboard pages:
   ```typescript
   const authenticatedPages = [
     { name: "Dashboard Home", path: "/dashboard" },
     { name: "Chat", path: "/chat" },
     { name: "Check-ins", path: "/check-ins" },
     { name: "Settings", path: "/dashboard/settings" },
     { name: "Next Steps", path: "/dashboard/next-steps" },
     { name: "Strategy", path: "/dashboard/strategy" },
     { name: "Insights", path: "/dashboard/insights" },
     { name: "Journey", path: "/dashboard/journey" },
     { name: "Coaching", path: "/dashboard/coaching" },
     { name: "Pitch Deck", path: "/dashboard/pitch-deck" },
     { name: "Investor Targeting", path: "/dashboard/investor-targeting" },
     { name: "Communities", path: "/dashboard/communities" },
     { name: "Documents", path: "/dashboard/documents" },
     { name: "Notifications", path: "/dashboard/notifications" },
     { name: "Wellbeing", path: "/dashboard/wellbeing" },
     { name: "Profile Snapshot", path: "/dashboard/profile/snapshot" },
   ];
   ```

2. Keep the existing test structure -- loop over pages, run axe-core with `wcag2a`, `wcag2aa`, `wcag21a`, `wcag21aa` tags, filter for critical/serious only.

3. Add a `test.setTimeout(30_000)` at the describe level to give slower pages time to load.

4. Add `await page.waitForSelector('[id="main-content"], main', { timeout: 10_000 }).catch(() => {})` before the axe analysis to ensure the main content area has rendered. This prevents false positives from analyzing loading states.

5. Keep the existing logging of violations (console.log with impact, id, description, and first 3 node HTML snippets).
  </action>
  <verify>
- `tests/e2e/accessibility-authenticated.spec.ts` has 15+ pages in the array
- Test file syntax is valid TypeScript
- Test includes waitForSelector before axe analysis
  </verify>
  <done>Accessibility test suite expanded from 5 to 16 dashboard pages with improved load-state handling</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `app/layout.tsx` has skip-to-content link
3. `app/dashboard/layout.tsx` has `id="main-content"` on main and `aria-label` on nav
4. `tests/e2e/accessibility-authenticated.spec.ts` covers 15+ pages
5. Loading spinner has `role="status"` and sr-only text
</verification>

<success_criteria>
- Skip-to-content link visible on keyboard focus on every page
- Dashboard main content area has proper landmark (main with id)
- Sidebar navigation has aria-label for screen readers
- Loading states have accessible status roles
- A11y test suite covers all core authenticated pages
- No critical/serious WCAG 2.1 AA violations on tested pages
</success_criteria>

<output>
After completion, create `.planning/phases/65-mobile-ux-polish/65-03-SUMMARY.md`
</output>
