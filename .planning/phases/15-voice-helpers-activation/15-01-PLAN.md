---
phase: 15-voice-helpers-activation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/ai/prompts.ts
  - lib/fred-brain.ts
  - lib/fred/types.ts
  - lib/fred/actors/validate-input.ts
  - lib/fred/actors/decide.ts
  - lib/fred/irs/engine.ts
  - lib/fred/strategy/generator.ts
  - components/chat/chat-interface.tsx
  - components/onboarding/fred-intro-step.tsx
  - lib/sms/templates.ts
  - app/api/fred/chat/route.ts
autonomous: true
must_haves:
  truths:
    - "FRED_MEDIA and FRED_TESTIMONIALS are imported and used in IRS engine and strategy generator prompts where Fred's credibility is relevant"
    - "Chat greeting in chat-interface.tsx dynamically uses getRandomQuote, getExperienceStatement, and getCredibilityStatement instead of a hardcoded string"
    - "SMS check-in template includes a Fred quote via getRandomQuote when message length permits (160-char limit respected)"
    - "Chat API routes topic-specific conversations through COACHING_PROMPTS via keyword-based topic detection in validate-input.ts and topic-aware response augmentation in decide.ts"
    - "Onboarding fred-intro-step.tsx uses getFredGreeting for the welcome message with startup context personalization"
  artifacts:
    - path: "lib/fred/types.ts"
      provides: "CoachingTopic type and optional topic field on ValidatedInput"
      exports: ["CoachingTopic", "ValidatedInput"]
    - path: "lib/fred/actors/validate-input.ts"
      provides: "Topic detection via keyword matching integrated into existing validation pipeline"
      exports: ["validateInputActor"]
    - path: "lib/fred/actors/decide.ts"
      provides: "Topic-aware response augmentation using COACHING_PROMPTS"
      exports: ["decideActor"]
    - path: "components/chat/chat-interface.tsx"
      provides: "Dynamic Fred greeting using fred-brain.ts helpers"
    - path: "components/onboarding/fred-intro-step.tsx"
      provides: "Personalized welcome using getFredGreeting"
    - path: "lib/sms/templates.ts"
      provides: "SMS check-in with Fred quote"
    - path: "lib/fred/irs/engine.ts"
      provides: "IRS system prompt with FRED_MEDIA and FRED_TESTIMONIALS credibility"
    - path: "lib/fred/strategy/generator.ts"
      provides: "Strategy system prompt with FRED_MEDIA credibility and corrected years of experience"
    - path: "lib/ai/prompts.ts"
      provides: "getFredGreeting enhanced with optional startup context parameter"
      exports: ["getFredGreeting"]
  key_links:
    - from: "components/chat/chat-interface.tsx"
      to: "lib/fred-brain.ts"
      via: "import getRandomQuote, getExperienceStatement, getCredibilityStatement"
      pattern: "getRandomQuote|getExperienceStatement|getCredibilityStatement"
    - from: "lib/fred/actors/validate-input.ts"
      to: "lib/fred/types.ts"
      via: "import CoachingTopic"
      pattern: "CoachingTopic"
    - from: "lib/fred/actors/decide.ts"
      to: "lib/ai/prompts.ts"
      via: "import COACHING_PROMPTS"
      pattern: "COACHING_PROMPTS"
    - from: "components/onboarding/fred-intro-step.tsx"
      to: "lib/ai/prompts.ts"
      via: "import getFredGreeting"
      pattern: "getFredGreeting"
    - from: "lib/fred/irs/engine.ts"
      to: "lib/fred-brain.ts"
      via: "import FRED_MEDIA, FRED_TESTIMONIALS"
      pattern: "FRED_MEDIA|FRED_TESTIMONIALS"
    - from: "lib/fred/strategy/generator.ts"
      to: "lib/fred-brain.ts"
      via: "import FRED_MEDIA, FRED_BIO"
      pattern: "FRED_MEDIA|FRED_BIO"
    - from: "lib/sms/templates.ts"
      to: "lib/fred-brain.ts"
      via: "import getRandomQuote"
      pattern: "getRandomQuote"
---

<objective>
Activate all unused fred-brain.ts exports and prompts.ts helpers across the Sahara platform so that FRED_MEDIA, FRED_TESTIMONIALS, COACHING_PROMPTS, getRandomQuote, getExperienceStatement, getCredibilityStatement, getPromptForTopic, and getFredGreeting are imported and used at their natural integration points.

Purpose: The codebase defines 8 well-implemented helpers and data exports that are never called. This leaves the chat greeting hardcoded, SMS messages generic, onboarding welcome inline, topic-specific coaching unused, and credibility data absent from prompts that would benefit from it. Wiring these exports in closes the gap between available personality data and actual user-facing interactions.

Output: Every fred-brain.ts and prompts.ts helper is actively imported and used -- chat greetings are dynamic, SMS includes Fred quotes, onboarding uses getFredGreeting, topic detection routes through COACHING_PROMPTS, and IRS/strategy prompts include media and testimonial credibility.
</objective>

<execution_context>
@/opt/agency-workspace/sierra-fred-carey/.planning/workflows/execute-plan.md
@/opt/agency-workspace/sierra-fred-carey/.planning/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-voice-helpers-activation/15-RESEARCH.md

Key source files:
@lib/fred-brain.ts
@lib/ai/prompts.ts
@lib/fred/types.ts
@lib/fred/actors/validate-input.ts
@lib/fred/actors/decide.ts
@lib/fred/irs/engine.ts
@lib/fred/strategy/generator.ts
@components/chat/chat-interface.tsx
@components/onboarding/fred-intro-step.tsx
@lib/sms/templates.ts
@app/api/fred/chat/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Activate FRED_MEDIA and FRED_TESTIMONIALS in credibility-relevant prompts (VOICE-11)</name>
  <files>
    lib/fred/irs/engine.ts
    lib/fred/strategy/generator.ts
    lib/ai/prompts.ts
  </files>
  <action>
**Step 1: Add FRED_MEDIA and FRED_TESTIMONIALS to IRS engine system prompt**

In `lib/fred/irs/engine.ts`, add imports for `FRED_MEDIA`, `FRED_TESTIMONIALS`, and `FRED_BIO` from `@/lib/fred-brain`. Then update the system prompt construction (the function that builds the IRS system prompt) to include a credibility block:

```typescript
import { FRED_MEDIA, FRED_TESTIMONIALS, FRED_BIO } from "@/lib/fred-brain";
```

In the system prompt string, replace the generic "expert VC analyst" framing with Fred's actual credentials:

```typescript
const credibilityBlock = `
Fred Cary's credentials: ${FRED_BIO.yearsExperience}+ years, ${FRED_BIO.companiesFounded}+ companies founded, ${FRED_BIO.ipos} IPOs.
Featured in: ${FRED_MEDIA.publications.slice(0, 5).join(", ")}.
${FRED_MEDIA.podcastAppearances}+ podcast appearances.

"${FRED_TESTIMONIALS[0].quote}" - ${FRED_TESTIMONIALS[0].name}, ${FRED_TESTIMONIALS[0].role}
`;
```

Insert this credibility block into the system prompt where the role/authority description is, so the AI grounds its investor readiness assessments in Fred's actual track record rather than a generic analyst persona.

**Step 2: Add FRED_MEDIA and FRED_BIO to strategy generator system prompt**

In `lib/fred/strategy/generator.ts`, add imports:

```typescript
import { FRED_MEDIA, FRED_BIO } from "@/lib/fred-brain";
```

In the `buildSystemPrompt` function (around line 150), replace the hardcoded "40+ years" with `${FRED_BIO.yearsExperience}+ years` to fix the data inconsistency. Also add a credibility line referencing Fred's media presence:

```typescript
// Replace hardcoded "40+ years" with:
`${FRED_BIO.yearsExperience}+ years of experience`

// Add media credibility:
`Featured in: ${FRED_MEDIA.publications.slice(0, 5).join(", ")}. ${FRED_MEDIA.podcastAppearances}+ podcast appearances.`
```

**Step 3: Optionally enhance main system prompt social proof section**

In `lib/ai/prompts.ts`, the `FRED_CAREY_SYSTEM_PROMPT` already has a "MY SOCIAL PROOF" section with hardcoded numbers. If the hardcoded values in this section differ from what FRED_MEDIA provides, update the social proof section to import from FRED_MEDIA for consistency. Since FRED_MEDIA is already exported from `fred-brain.ts` (which `prompts.ts` already imports from), this is just adding the import and replacing hardcoded numbers.

Do NOT dump the full podcast list into the system prompt. Only use the compact metadata: `publications`, `recognition`, `socialMetrics`, and `podcastAppearances` count.
  </action>
  <verify>
1. **FRED_MEDIA imported in IRS engine:**
   ```bash
   grep 'FRED_MEDIA\|FRED_TESTIMONIALS' lib/fred/irs/engine.ts
   ```

2. **FRED_MEDIA imported in strategy generator:**
   ```bash
   grep 'FRED_MEDIA\|FRED_BIO' lib/fred/strategy/generator.ts
   ```

3. **No "40+ years" remaining in strategy generator:**
   ```bash
   grep -c '40+' lib/fred/strategy/generator.ts
   # Should be 0
   ```

4. **TypeScript compiles:**
   ```bash
   npx tsc --noEmit 2>&1 | head -20
   ```
  </verify>
  <done>
VOICE-11: FRED_MEDIA and FRED_TESTIMONIALS imported and used in lib/fred/irs/engine.ts (IRS system prompt now includes Fred's publications, podcast count, and a testimonial). FRED_MEDIA and FRED_BIO imported and used in lib/fred/strategy/generator.ts (strategy system prompt now uses dynamic years of experience from FRED_BIO.yearsExperience, replacing the incorrect hardcoded "40+ years", and includes media credibility). Main system prompt social proof section updated to import from FRED_MEDIA for consistency.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire helpers into chat greeting and SMS templates (VOICE-12)</name>
  <files>
    components/chat/chat-interface.tsx
    lib/sms/templates.ts
  </files>
  <action>
**Step 1: Replace hardcoded FRED_GREETING in chat-interface.tsx**

In `components/chat/chat-interface.tsx`, the `FRED_GREETING` constant (around lines 17-23) is a hardcoded 4-paragraph greeting string. Replace it with a dynamic greeting using the fred-brain.ts helpers.

Add imports:
```typescript
import { getRandomQuote, getExperienceStatement, getCredibilityStatement } from "@/lib/fred-brain";
```

Create a greeting builder function:
```typescript
function buildFredGreeting(): Message {
  const quote = getRandomQuote();
  const experience = getExperienceStatement();
  const credibility = getCredibilityStatement();
  return {
    id: "greeting",
    content: `Hey there! I'm Fred Cary. ${experience}\n\n${credibility}\n\nThink of me as your digital co-founder, available 24/7. Whether you're validating an idea, preparing for fundraising, or figuring out your next big move -- I'm here to give you the straight truth.\n\n"${quote}" What's on your mind?`,
    role: "assistant",
    timestamp: new Date(),
  };
}
```

Remove the hardcoded `FRED_GREETING` constant and replace its usage with the builder function.

IMPORTANT: To avoid React hydration mismatches from `Math.random()` producing different results across renders, use `useState` with a lazy initializer to compute the greeting ONCE on component mount:

```typescript
const [greeting] = useState<Message>(() => buildFredGreeting());
```

This is safe because `chat-interface.tsx` is a client component ("use client") and the helpers are pure functions with no server imports. The `fred-brain.ts` file contains only constants and pure functions with zero imports, making it safe for client-side use.

**Step 2: Add Fred quote to SMS check-in template**

In `lib/sms/templates.ts`, add the import:
```typescript
import { getRandomQuote } from "@/lib/fred-brain";
```

Update the `getCheckinTemplate` function to attempt including a Fred quote. SMS messages MUST stay under 160 characters (single SMS segment). The approach:

1. Build the message with a Fred quote included
2. Check if the total length is within 160 characters
3. If yes, use the message with the quote
4. If no, fall back to the existing generic message (without the quote)

```typescript
export function getCheckinTemplate(founderName: string, highlights?: string[]): string {
  const quote = getRandomQuote();
  const greeting = `Hey ${founderName}!`;
  const cta = 'Reply with your top 3 priorities.';

  // Try to include a Fred quote if there's space
  const withQuote = `${greeting} "${quote}" - Fred. ${cta}`;
  if (withQuote.length <= MAX_SMS_LENGTH) {
    return withQuote;
  }

  // Fall back to simpler message without quote
  const simple = `${greeting} Weekly check-in from Sahara. ${cta}`;
  return simple.slice(0, MAX_SMS_LENGTH);
}
```

Do NOT use `getExperienceStatement()` or `getCredibilityStatement()` in SMS -- they return strings far too long for the 160-character limit. Only `getRandomQuote()` returns content short enough to fit.

Preserve any existing `.slice(0, MAX_SMS_LENGTH)` truncation patterns in the templates file.
  </action>
  <verify>
1. **Chat greeting uses helpers:**
   ```bash
   grep 'getRandomQuote\|getExperienceStatement\|getCredibilityStatement' components/chat/chat-interface.tsx
   ```

2. **No hardcoded FRED_GREETING constant remains:**
   ```bash
   grep -c 'FRED_GREETING' components/chat/chat-interface.tsx
   # Should be 0 (or only the function name buildFredGreeting)
   ```

3. **SMS template uses getRandomQuote:**
   ```bash
   grep 'getRandomQuote' lib/sms/templates.ts
   ```

4. **SMS template respects 160-char limit:**
   ```bash
   grep 'MAX_SMS_LENGTH\|160\|slice' lib/sms/templates.ts
   ```

5. **TypeScript compiles:**
   ```bash
   npx tsc --noEmit 2>&1 | head -20
   ```
  </verify>
  <done>
VOICE-12: Chat greeting in components/chat/chat-interface.tsx now uses getRandomQuote, getExperienceStatement, and getCredibilityStatement dynamically via a buildFredGreeting function with useState lazy initializer (avoids hydration mismatch). Hardcoded FRED_GREETING constant removed. SMS check-in template in lib/sms/templates.ts now includes a Fred quote via getRandomQuote when the total message fits within the 160-character SMS limit, falling back to the generic template otherwise.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add topic detection and COACHING_PROMPTS routing to chat pipeline (VOICE-13)</name>
  <files>
    lib/fred/types.ts
    lib/fred/actors/validate-input.ts
    lib/fred/actors/decide.ts
    app/api/fred/chat/route.ts
  </files>
  <action>
**Step 1: Add CoachingTopic type and topic field to ValidatedInput**

In `lib/fred/types.ts`, add a new `CoachingTopic` type and an optional `topic` field to the `ValidatedInput` interface:

```typescript
export type CoachingTopic = "fundraising" | "pitchReview" | "strategy" | "positioning" | "mindset";
```

Add `topic?: CoachingTopic;` as an optional field on the `ValidatedInput` interface. This is an additive change -- the field is optional, so existing code that constructs `ValidatedInput` without a topic will continue to work. No existing tests will break.

**Step 2: Add topic detection to validate-input.ts**

In `lib/fred/actors/validate-input.ts`, add a `detectTopic` function after the existing intent detection logic. This function uses simple keyword matching (consistent with the existing keyword/regex-based intent detection pattern in the same file):

```typescript
import { CoachingTopic } from "@/lib/fred/types";

const TOPIC_KEYWORDS: Record<CoachingTopic, string[]> = {
  fundraising: ["fundrais", "raise", "investor", "vc", "capital", "funding", "round", "valuation", "term sheet"],
  pitchReview: ["pitch", "deck", "slides", "presentation", "investor deck", "pitch deck"],
  strategy: ["strategy", "plan", "roadmap", "pivot", "direction", "prioritize", "next steps", "execute"],
  positioning: ["positioning", "differentiat", "market fit", "value prop", "brand", "competitive", "messaging"],
  mindset: ["mindset", "motivat", "stuck", "overwhelm", "doubt", "confidence", "fear", "burnout", "stress"],
};

function detectTopic(message: string, keywords: string[]): CoachingTopic | undefined {
  const lowerMessage = message.toLowerCase();
  let bestTopic: CoachingTopic | undefined;
  let bestScore = 0;

  for (const [topic, words] of Object.entries(TOPIC_KEYWORDS)) {
    const score = words.filter(
      (w) => lowerMessage.includes(w) || keywords.some((k) => k.includes(w))
    ).length;
    if (score > bestScore) {
      bestScore = score;
      bestTopic = topic as CoachingTopic;
    }
  }

  return bestScore > 0 ? bestTopic : undefined;
}
```

Call `detectTopic` within the existing validation logic (where intent, keywords, and sentiment are already extracted) and assign the result to the `topic` field of the returned `ValidatedInput` object.

IMPORTANT: Topic detection is ORTHOGONAL to intent detection. A user can have `intent="question"` AND `topic="fundraising"`. Do NOT modify the intent field based on topic. Add topic as a separate field only.

Do NOT add new states to the XState machine. Topic is just a data field on ValidatedInput, not a machine state.

**Step 3: Use detected topic in decide.ts for response augmentation**

In `lib/fred/actors/decide.ts`, import `COACHING_PROMPTS` from `@/lib/ai/prompts`:

```typescript
import { COACHING_PROMPTS } from "@/lib/ai/prompts";
```

In the `buildResponseContent` function (or wherever the response content is assembled), check if the validated input has a detected topic. If it does, augment the response context with the relevant coaching prompt:

```typescript
// When building the response, if a topic was detected:
if (validatedInput.topic && COACHING_PROMPTS[validatedInput.topic]) {
  const coachingContext = COACHING_PROMPTS[validatedInput.topic];
  // Prepend or append the coaching prompt context to guide the response
  // Use only the coaching-specific portion, NOT getPromptForTopic() which returns the FULL system prompt
}
```

IMPORTANT: Use `COACHING_PROMPTS[topic]` directly, NOT `getPromptForTopic()`. The `getPromptForTopic()` function returns the FULL system prompt concatenated with the coaching prompt, which would duplicate the system prompt in the chat pipeline (where it's already set). Only the topic-specific coaching guidance portion is needed here.

**Step 4: Verify chat API route passes topic through the pipeline**

Check `app/api/fred/chat/route.ts` to confirm the validated input (including the new `topic` field) flows through the state machine pipeline from `validateInput` to `decide`. Since the topic is part of the `ValidatedInput` object that already flows through the XState machine context, no changes to the route or machine should be needed -- the topic field will automatically be carried through the existing pipeline.

If the route or service does any filtering or transformation of the validated input before passing it to the decide actor, ensure the `topic` field is preserved.
  </action>
  <verify>
1. **CoachingTopic type exists:**
   ```bash
   grep 'CoachingTopic' lib/fred/types.ts
   ```

2. **Topic field on ValidatedInput:**
   ```bash
   grep 'topic.*CoachingTopic' lib/fred/types.ts
   ```

3. **Topic detection function in validate-input.ts:**
   ```bash
   grep 'detectTopic' lib/fred/actors/validate-input.ts
   ```

4. **COACHING_PROMPTS imported in decide.ts:**
   ```bash
   grep 'COACHING_PROMPTS' lib/fred/actors/decide.ts
   ```

5. **Topic used in response building:**
   ```bash
   grep 'validatedInput.topic\|\.topic' lib/fred/actors/decide.ts
   ```

6. **Existing tests still pass:**
   ```bash
   npx vitest run lib/fred/__tests__/ 2>&1 | tail -10
   ```

7. **TypeScript compiles:**
   ```bash
   npx tsc --noEmit 2>&1 | head -20
   ```
  </verify>
  <done>
VOICE-13: CoachingTopic type added to lib/fred/types.ts with optional topic field on ValidatedInput. Topic detection via keyword matching added to lib/fred/actors/validate-input.ts (5 topics: fundraising, pitchReview, strategy, positioning, mindset). COACHING_PROMPTS imported and used in lib/fred/actors/decide.ts to augment responses with topic-specific coaching context when a topic is detected. Topic flows through the existing XState pipeline automatically as part of ValidatedInput context.
  </done>
</task>

<task type="auto">
  <name>Task 4: Wire getFredGreeting into onboarding flow (VOICE-14)</name>
  <files>
    lib/ai/prompts.ts
    components/onboarding/fred-intro-step.tsx
  </files>
  <action>
**Step 1: Enhance getFredGreeting to accept optional startup context**

In `lib/ai/prompts.ts`, modify `getFredGreeting` to optionally accept startup context parameters for personalization. The function is currently unused (confirmed by grep), so changing its signature has zero breaking-change risk.

```typescript
export function getFredGreeting(startupContext?: {
  name?: string;
  stage?: string;
  mainChallenge?: string;
}): string {
  // Existing: pick a random base greeting from the greetings array
  const baseGreeting = FRED_GREETINGS[Math.floor(Math.random() * FRED_GREETINGS.length)];

  // If no startup context, return the base greeting as before
  if (!startupContext) {
    return baseGreeting;
  }

  // Add personalization when startup context is provided
  const name = startupContext.name || "your startup";
  const stage = startupContext.stage?.replace("-", " ") || "startup";
  const challenge = startupContext.mainChallenge || "growth";

  return `${baseGreeting}\n\nSo you're working on ${name} at the ${stage} stage, focusing on ${challenge}. Let's dig in.`;
}
```

This maintains backward compatibility (calling `getFredGreeting()` with no args still works) while enabling personalized greetings when startup info is available.

**Step 2: Replace inline welcome message in fred-intro-step.tsx**

In `components/onboarding/fred-intro-step.tsx`, replace the `generateWelcome` function's inline template string (around lines 32-43) with a call to `getFredGreeting`:

```typescript
import { getFredGreeting } from "@/lib/ai/prompts";
```

Update the `generateWelcome` function:
```typescript
const generateWelcome = () => {
  const welcomeMessage = getFredGreeting({
    name: startupInfo.name,
    stage: startupInfo.stage,
    mainChallenge: startupInfo.mainChallenge,
  });

  setMessages([{ id: "welcome", role: "assistant", content: welcomeMessage }]);
};
```

This replaces the hardcoded inline welcome with Fred's personality-driven greeting while preserving the startup-specific personalization.

IMPORTANT: If `fred-intro-step.tsx` is a client component ("use client"), verify that `lib/ai/prompts.ts` can be imported client-side. The `getFredGreeting` function only uses constants and Math.random() -- no server-only imports. However, if `prompts.ts` imports anything server-only (like `fs` or database clients), the import will fail. In that case, extract `getFredGreeting` and its greeting data into a separate client-safe file, or import only the specific function. Based on the research, `prompts.ts` imports only from `@/lib/fred-brain` (which has zero imports), so client-side import should be safe.
  </action>
  <verify>
1. **getFredGreeting accepts optional parameter:**
   ```bash
   grep -A5 'getFredGreeting' lib/ai/prompts.ts | head -10
   ```

2. **Onboarding uses getFredGreeting:**
   ```bash
   grep 'getFredGreeting' components/onboarding/fred-intro-step.tsx
   ```

3. **No inline hardcoded welcome message remains:**
   ```bash
   grep -c "Hey! So you're working on" components/onboarding/fred-intro-step.tsx
   # Should be 0
   ```

4. **TypeScript compiles:**
   ```bash
   npx tsc --noEmit 2>&1 | head -20
   ```
  </verify>
  <done>
VOICE-14: getFredGreeting in lib/ai/prompts.ts enhanced to accept optional startup context (name, stage, mainChallenge) for personalized greetings while maintaining backward compatibility. Onboarding fred-intro-step.tsx updated to use getFredGreeting with startup context instead of inline hardcoded welcome message.
  </done>
</task>

</tasks>

<verification>
After all four tasks complete, verify the full activation of all 8 previously-unused exports:

1. **All exports are now imported somewhere:**
   ```bash
   # Each should return at least 1 file OUTSIDE its defining file
   grep -rn 'FRED_MEDIA' lib/ components/ app/ --include="*.ts" --include="*.tsx" | grep -v 'fred-brain.ts' | grep -v 'node_modules'
   grep -rn 'FRED_TESTIMONIALS' lib/ components/ app/ --include="*.ts" --include="*.tsx" | grep -v 'fred-brain.ts' | grep -v 'node_modules'
   grep -rn 'getRandomQuote' lib/ components/ app/ --include="*.ts" --include="*.tsx" | grep -v 'fred-brain.ts' | grep -v 'node_modules'
   grep -rn 'getExperienceStatement' lib/ components/ app/ --include="*.ts" --include="*.tsx" | grep -v 'fred-brain.ts' | grep -v 'node_modules'
   grep -rn 'getCredibilityStatement' lib/ components/ app/ --include="*.ts" --include="*.tsx" | grep -v 'fred-brain.ts' | grep -v 'node_modules'
   grep -rn 'COACHING_PROMPTS' lib/ components/ app/ --include="*.ts" --include="*.tsx" | grep -v 'prompts.ts' | grep -v 'node_modules'
   grep -rn 'getPromptForTopic\|getFredGreeting' lib/ components/ app/ --include="*.ts" --include="*.tsx" | grep -v 'prompts.ts' | grep -v 'node_modules'
   ```

2. **No "40+ years" in strategy generator:**
   ```bash
   grep -c '40+' lib/fred/strategy/generator.ts
   # Should be 0
   ```

3. **TypeScript compiles with zero errors:**
   ```bash
   npx tsc --noEmit
   ```

4. **Existing tests still pass:**
   ```bash
   npx vitest run 2>&1 | tail -20
   ```

5. **Build succeeds:**
   ```bash
   rm -rf .next && next build --webpack 2>&1 | tail -20
   ```
</verification>

<success_criteria>
- FRED_MEDIA and FRED_TESTIMONIALS are imported and used in lib/fred/irs/engine.ts and lib/fred/strategy/generator.ts system prompts
- Strategy generator no longer hardcodes "40+ years" -- uses FRED_BIO.yearsExperience dynamically
- Chat greeting in components/chat/chat-interface.tsx uses getRandomQuote, getExperienceStatement, and getCredibilityStatement dynamically (not hardcoded)
- Chat greeting uses useState lazy initializer to avoid hydration mismatch from Math.random()
- SMS check-in template in lib/sms/templates.ts includes a Fred quote via getRandomQuote when within 160-char SMS limit
- CoachingTopic type defined in lib/fred/types.ts with 5 topics (fundraising, pitchReview, strategy, positioning, mindset)
- ValidatedInput in lib/fred/types.ts has an optional topic field of type CoachingTopic
- Topic detection via keyword matching added to lib/fred/actors/validate-input.ts
- COACHING_PROMPTS used in lib/fred/actors/decide.ts to augment topic-specific responses
- getFredGreeting in lib/ai/prompts.ts enhanced with optional startup context parameter (backward compatible)
- Onboarding fred-intro-step.tsx uses getFredGreeting with startup context for personalized welcome
- TypeScript compilation passes with zero errors
- All existing tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/15-voice-helpers-activation/15-01-SUMMARY.md`
</output>
