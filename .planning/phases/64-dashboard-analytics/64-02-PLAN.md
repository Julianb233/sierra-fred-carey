---
phase: 64-dashboard-analytics
plan: 02
type: execute
wave: 2
depends_on: ["64-01"]
files_modified:
  - app/dashboard/analytics/page.tsx
  - components/dashboard/activity-trend-chart.tsx
  - components/dashboard/momentum-indicator.tsx
  - components/dashboard/sparkline-card.tsx
  - app/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Founder can navigate to /dashboard/analytics and see sparkline cards for 4 key metrics"
    - "Founder can select time range (7d/30d/90d/All) and see charts update"
    - "Founder can click a sparkline to expand into a full detailed chart"
    - "Momentum indicator shows trend arrow and factual summary on both home page and analytics page"
    - "Analytics page shows empty states with encouraging CTAs when no data exists"
  artifacts:
    - path: "app/dashboard/analytics/page.tsx"
      provides: "Analytics dashboard page"
      min_lines: 80
    - path: "components/dashboard/activity-trend-chart.tsx"
      provides: "Full AreaChart for activity trends with tooltips"
      min_lines: 40
    - path: "components/dashboard/momentum-indicator.tsx"
      provides: "Trend arrow + summary text component"
      min_lines: 30
    - path: "components/dashboard/sparkline-card.tsx"
      provides: "Compact sparkline metric card with click-to-expand"
      min_lines: 40
  key_links:
    - from: "app/dashboard/analytics/page.tsx"
      to: "/api/dashboard/trends"
      via: "fetch in useEffect"
      pattern: "fetch.*api/dashboard/trends"
    - from: "app/dashboard/analytics/page.tsx"
      to: "/api/dashboard/engagement"
      via: "fetch in useEffect"
      pattern: "fetch.*api/dashboard/engagement"
    - from: "app/dashboard/page.tsx"
      to: "components/dashboard/momentum-indicator.tsx"
      via: "import MomentumIndicator"
      pattern: "MomentumIndicator"
---

<objective>
Build the analytics page UI with sparkline cards, expandable trend charts, time range selector, and momentum indicator. Wire to the API endpoints created in Plan 01. Add momentum summary to the dashboard home page.

Purpose: Founders can see their activity trends over time and understand their momentum trajectory at a glance.
Output: New `/dashboard/analytics` page with 4 sparkline cards, expandable charts, time range selector, and momentum indicator. Momentum also shown on home page.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/64-dashboard-analytics/64-RESEARCH.md
@.planning/phases/64-dashboard-analytics/64-CONTEXT.md
@.planning/phases/64-dashboard-analytics/64-01-SUMMARY.md

Key existing files to reference:
@app/dashboard/page.tsx — Dashboard home page; add MomentumIndicator here
@components/insights/trend-charts.tsx — Established Recharts pattern (AreaChart, gradients, tooltips, colors)
@components/dashboard/weekly-momentum.tsx — Existing momentum widget (add momentum indicator near this)
@components/dashboard/funding-readiness-gauge.tsx — Card styling pattern to follow
@lib/dashboard/trends.ts — TrendPeriod type (from Plan 01)
@lib/dashboard/engagement-score.ts — MomentumIndicator type (from Plan 01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sparkline card and chart components</name>
  <files>components/dashboard/sparkline-card.tsx, components/dashboard/activity-trend-chart.tsx, components/dashboard/momentum-indicator.tsx</files>
  <action>
Create `components/dashboard/sparkline-card.tsx`:
- "use client" component
- Props: `{ title: string; value: string | number; data: {value: number}[]; color: string; expanded: boolean; onToggle: () => void }`
- Compact card (shadcn Card) showing:
  - Title (text-sm muted)
  - Current value (text-2xl font-bold)
  - Tiny recharts `LineChart` sparkline (height=40, no axes, no grid, just the line with color prop)
  - Click handler toggles `expanded` state
- When expanded, render full-size chart below the sparkline row (not inside the card -- handled by parent)
- Follow card styling from `funding-readiness-gauge.tsx`: `border-orange-100/20 dark:border-white/5 bg-white/50 dark:bg-black/20 backdrop-blur-sm`
- Cursor pointer on card to indicate clickability

Create `components/dashboard/activity-trend-chart.tsx`:
- "use client" component
- Props: `{ data: TrendPeriod[]; metric: string }` where metric is one of the TrendPeriod keys
- Full AreaChart following EXACT pattern from `components/insights/trend-charts.tsx`:
  - `ResponsiveContainer` width=100% height=300
  - Gradient defs with app colors: #ff6a1a (orange), #8b5cf6 (purple), #10b981 (green), #3b82f6 (blue)
  - CartesianGrid with strokeDasharray="3 3" and className="stroke-muted"
  - XAxis/YAxis with fontSize=12, className="text-muted-foreground"
  - Custom Tooltip with `rounded-lg border bg-background p-3 shadow-lg`
  - Area with gradient fill
- When metric is "nextStepsCompleted" show orange, "checkIns" show purple, "readinessProgress" show green, "conversations" show blue
- Empty state: Card with centered muted text "No trend data available yet"

Create `components/dashboard/momentum-indicator.tsx`:
- "use client" component
- Props: `{ trend: "rising" | "stable" | "declining"; summary: string; compact?: boolean }`
- Compact mode (for home page): Single row with trend arrow icon + summary text
  - Rising: TrendingUp icon (lucide) in green
  - Stable: Minus icon in yellow/amber
  - Declining: TrendingDown icon in orange (NOT red -- factual, not alarming)
- Full mode (for analytics page): Card with trend arrow, summary, and breakdown details
- Use `TrendingUp`, `TrendingDown`, `Minus` from lucide-react
- Text style: factual and encouraging per CONTEXT.md. No judgmental language.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm all three components have no type errors. Verify each component is a "use client" component. Verify recharts imports match established patterns.
  </verify>
  <done>
Three reusable chart components exist: SparklineCard (compact metric with mini chart), ActivityTrendChart (full recharts AreaChart), MomentumIndicator (trend arrow + summary). All follow established Recharts and shadcn patterns.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create analytics page and wire momentum to home page</name>
  <files>app/dashboard/analytics/page.tsx, app/dashboard/page.tsx</files>
  <action>
Create `app/dashboard/analytics/page.tsx`:
- "use client" component with Suspense wrapper (follow dashboard/page.tsx pattern)
- State: `trends: TrendPeriod[]`, `momentum: MomentumIndicator | null`, `range: "7d"|"30d"|"90d"|"all"`, `expandedMetric: string | null`, `loading: boolean`
- On mount, fetch both `/api/dashboard/trends?range=30d` and `/api/dashboard/engagement` in parallel
- When range changes, re-fetch trends with new range param
- Layout:
  1. Header: "Analytics" title + time range selector (4 buttons: 7d / 30d / 90d / All, styled as pill toggle group using shadcn Button variants -- `variant="ghost"` for inactive, `variant="secondary"` for active)
  2. Momentum indicator (full mode) — MomentumIndicator component
  3. Sparkline grid (2x2 on desktop, 1 col on mobile) with 4 SparklineCard components:
     - "Next Steps Completed" — data from trends[].nextStepsCompleted, color=#ff6a1a
     - "Check-in Streaks" — data from trends[].checkIns, color=#8b5cf6
     - "Readiness Scores" — data from trends[].decisionsScored, color=#10b981
     - "Conversations" — data from trends[].conversations, color=#3b82f6
  4. When a sparkline is clicked (expandedMetric set), show ActivityTrendChart below the sparkline grid for that metric
  5. "Next Identified Step" display — prominent card linking to /dashboard/next-steps (use data from command-center API if available, or just show a CTA link)
- Loading state: Skeleton cards matching layout
- Empty state: Encouraging message "Start working with Fred to see your analytics" with CTA button to /chat
- Error state: Graceful, show empty state

Modify `app/dashboard/page.tsx`:
- Import MomentumIndicator component
- Add momentum state: `const [momentum, setMomentum] = useState<MomentumIndicator | null>(null)`
- In the existing `fetchData` useEffect, add a parallel fetch to `/api/dashboard/engagement` (add to the existing try block, NOT a separate useEffect)
- Render `<MomentumIndicator trend={momentum.trend} summary={momentum.summary} compact />` between the WeeklyMomentum widget and the end of the page (only if momentum is not null)
- Import the MomentumIndicator type from `@/lib/dashboard/engagement-score`
- Do NOT change any existing layout or components — only ADD the momentum indicator
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Verify `app/dashboard/analytics/page.tsx` exists and is a valid page component. Verify `app/dashboard/page.tsx` still renders correctly (no broken imports). Check that the analytics page fetches from both API endpoints.
  </verify>
  <done>
`/dashboard/analytics` page renders with 4 sparkline cards, time range selector (7d/30d/90d/All), expandable trend charts, and momentum indicator. Dashboard home page shows compact momentum indicator. Empty states work for new users with no data.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `/dashboard/analytics` page renders without errors
3. Time range selector switches between 7d/30d/90d/All and re-fetches data
4. Sparkline cards are clickable and expand to full charts
5. Momentum indicator shows on both analytics page (full) and home page (compact)
6. Empty states render gracefully for users with no activity data
7. No new npm packages installed
8. Dashboard home page (`/dashboard`) still renders all existing widgets correctly
</verification>

<success_criteria>
- Analytics page accessible at `/dashboard/analytics` with 4 sparkline metric cards
- Time range toggle (7d/30d/90d/All) controls data range
- Click-to-expand on sparklines shows full Recharts AreaChart
- Momentum indicator (trend arrow + summary) visible on analytics page and home page
- All Recharts components follow established patterns (gradients, colors, tooltips)
- Graceful empty/loading/error states throughout
</success_criteria>

<output>
After completion, create `.planning/phases/64-dashboard-analytics/64-02-SUMMARY.md`
</output>
