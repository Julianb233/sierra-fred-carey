# Plan 10-02: Bug Fixes & Validation Alignment

**Phase:** 10 - Production Hardening & Launch Prep
**Priority:** P1-P2 (Pre-launch)
**Estimated Scope:** 4 files modified

---

## Objective

Fix known bugs and mismatches found in v1.0 audits: password validation mismatch between client and server, SMS nav tier badge, and onboarding session continuity verification.

---

## Tasks

### Task 1: Align Password Validation (Client ↔ Server)

**Files:**
- `app/get-started/page.tsx` (client - currently allows 6+ chars)
- `app/api/onboard/route.ts` (server - requires 8+ chars + uppercase + digit)

**Issue:** Users entering 6-7 char lowercase passwords pass client validation but fail on server with a confusing error.

**Action:** Align client validation to match server requirements:
1. Update client-side password validation to require 8+ chars, at least 1 uppercase, 1 digit
2. Add inline validation feedback showing requirements
3. Show password requirements hint below the field

**Validation regex (match server):**
```typescript
const passwordValid = password.length >= 8
  && /[A-Z]/.test(password)
  && /[0-9]/.test(password);
```

### Task 2: Fix SMS Nav Tier Badge

**File:** `app/dashboard/layout.tsx` (lines 112-118)

**Issue:** "Weekly Check-ins" nav item shows `tier: 1` (Pro) with `badge: "Pro"`, but SMS is a Studio-tier feature. API and FeatureLock correctly enforce Studio access, but nav badge misleads Pro users.

**Action:**
1. Change `tier: 1` → `tier: 2` in the nav item config
2. Change `badge: "Pro"` → `badge: "Studio"`

### Task 3: Verify Onboarding Session Continuity

**File:** `app/get-started/page.tsx`

**Issue:** After server-side `signUp`, redirect to `/dashboard` may not have session cookie propagated correctly since `middleware.ts` was deleted.

**Action:**
1. Trace the auth flow: `signUp` → cookie set → redirect → dashboard access
2. Verify Supabase SSR client properly sets cookies on server-side signUp
3. If cookie isn't set: add explicit `supabase.auth.setSession()` or cookie header in redirect response
4. If working correctly: document in verification notes

---

## Verification

- [ ] Client rejects passwords under 8 chars, missing uppercase, or missing digit
- [ ] Client shows inline requirements text
- [ ] Server and client validation rules are identical
- [ ] SMS nav shows "Studio" badge with tier 2
- [ ] Pro users see lock overlay on SMS page (not misleading access)
- [ ] New user signup → onboarding → dashboard works without re-login
- [ ] `npx tsc --noEmit` passes
- [ ] `npx vitest run` passes

---

## Dependencies

None - independent of 10-01.

---

*Plan created: 2026-02-06*
