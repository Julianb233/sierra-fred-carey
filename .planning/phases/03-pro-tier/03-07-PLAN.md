---
phase: 03-pro-tier
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/db/migrations/027_strategy_documents.sql
  - lib/fred/strategy/types.ts
  - lib/fred/strategy/templates/executive-summary.ts
  - lib/fred/strategy/templates/market-analysis.ts
  - lib/fred/strategy/templates/30-60-90-plan.ts
  - lib/fred/strategy/templates/competitive-analysis.ts
  - lib/fred/strategy/templates/gtm-plan.ts
  - lib/fred/strategy/templates/index.ts
  - lib/fred/strategy/generator.ts
  - lib/fred/strategy/db.ts
  - lib/fred/strategy/index.ts
  - lib/documents/export.ts
  - app/api/fred/strategy/route.ts
  - app/api/fred/strategy/[id]/route.ts
  - app/api/fred/strategy/[id]/export/route.ts
  - components/strategy/document-type-selector.tsx
  - components/strategy/document-preview.tsx
  - components/strategy/generation-progress.tsx
  - components/strategy/document-list.tsx
  - components/strategy/index.ts
  - app/dashboard/strategy/page.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "5 strategy document templates exist with structured section prompts"
    - "Strategy generator produces multi-section documents using FRED's voice"
    - "POST /api/fred/strategy generates documents with Pro tier gating"
    - "GET/PUT/DELETE /api/fred/strategy/[id] provides full CRUD"
    - "Export endpoint returns PDF via @react-pdf/renderer"
    - "Dashboard page at /dashboard/strategy allows type selection, generation, document list, preview, and export"
  artifacts:
    - path: "lib/fred/strategy/types.ts"
      provides: "StrategyDocType, StrategyTemplate, GeneratedDocument, StrategyInput interfaces"
      exports: ["StrategyDocType", "STRATEGY_DOC_TYPES", "DOC_TYPE_LABELS", "DOC_TYPE_DESCRIPTIONS", "StrategyTemplate", "TemplateSection", "GeneratedSection", "GeneratedDocument", "StrategyInput"]
    - path: "lib/fred/strategy/templates/executive-summary.ts"
      provides: "Executive summary template with 7 sections"
      exports: ["executiveSummaryTemplate"]
    - path: "lib/fred/strategy/templates/market-analysis.ts"
      provides: "Market analysis template with 6 sections"
      exports: ["marketAnalysisTemplate"]
    - path: "lib/fred/strategy/templates/30-60-90-plan.ts"
      provides: "30-60-90 day plan template with 6 sections"
      exports: ["plan306090Template"]
    - path: "lib/fred/strategy/templates/competitive-analysis.ts"
      provides: "Competitive analysis template with 5 sections"
      exports: ["competitiveAnalysisTemplate"]
    - path: "lib/fred/strategy/templates/gtm-plan.ts"
      provides: "Go-to-market plan template with 6 sections"
      exports: ["gtmPlanTemplate"]
    - path: "lib/fred/strategy/templates/index.ts"
      provides: "Template registry mapping doc type to template"
      exports: ["TEMPLATES", "getTemplate"]
    - path: "lib/fred/strategy/generator.ts"
      provides: "AI document generation using section-by-section prompts"
      exports: ["generateDocument", "generateSection"]
    - path: "lib/fred/strategy/db.ts"
      provides: "CRUD for strategy_documents table"
      exports: ["saveStrategyDocument", "getStrategyDocuments", "getStrategyDocumentById", "updateStrategyDocument", "deleteStrategyDocument"]
    - path: "lib/fred/strategy/index.ts"
      provides: "Barrel re-export for strategy module"
    - path: "lib/documents/export.ts"
      provides: "PDF export using @react-pdf/renderer"
      exports: ["exportToPDF"]
    - path: "app/api/fred/strategy/route.ts"
      provides: "POST to generate, GET to list strategy documents"
      exports: ["POST", "GET"]
    - path: "app/api/fred/strategy/[id]/route.ts"
      provides: "GET, PUT, DELETE for individual documents"
      exports: ["GET", "PUT", "DELETE"]
    - path: "app/api/fred/strategy/[id]/export/route.ts"
      provides: "GET endpoint returning PDF buffer"
      exports: ["GET"]
    - path: "app/dashboard/strategy/page.tsx"
      provides: "Functional strategy page replacing semi-mock"
    - path: "lib/db/migrations/027_strategy_documents.sql"
      provides: "Database table for strategy documents"
      contains: "CREATE TABLE"
  key_links:
    - from: "app/api/fred/strategy/route.ts"
      to: "lib/fred/strategy/generator.ts"
      via: "POST handler calls generateDocument"
      pattern: "generateDocument"
    - from: "app/api/fred/strategy/route.ts"
      to: "lib/api/tier-middleware.ts"
      via: "checkTierForRequest(request, UserTier.PRO)"
      pattern: "checkTierForRequest"
    - from: "lib/fred/strategy/generator.ts"
      to: "lib/fred/strategy/templates/index.ts"
      via: "getTemplate(docType) to load section prompts"
      pattern: "getTemplate"
    - from: "app/api/fred/strategy/[id]/export/route.ts"
      to: "lib/documents/export.ts"
      via: "exportToPDF() call"
      pattern: "exportToPDF"
    - from: "app/dashboard/strategy/page.tsx"
      to: "/api/fred/strategy"
      via: "fetch calls for CRUD and generation"
      pattern: "fetch.*api/fred/strategy"
---

<objective>
Build the complete Strategy Document Generation feature, closing UAT gaps 3 (Test 8) and 4 (Test 9).

Purpose: Pro tier users can generate AI-powered strategy documents (executive summaries, market analyses, 30/60/90 plans, competitive analyses, GTM plans) using FRED's voice and export them as PDF. Plan 03-04 was marked complete but zero code exists -- this is a full implementation from scratch.

Output: Working strategy module (lib/fred/strategy/), export utility (lib/documents/export.ts), API endpoints (POST/GET/PUT/DELETE /api/fred/strategy), and functional dashboard page replacing the existing semi-mock at /dashboard/strategy.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-pro-tier/03-UAT.md

Existing patterns to follow (read these files for exact code patterns):
@lib/fred/irs/types.ts — Type definitions pattern with const arrays and Record maps
@lib/fred/irs/engine.ts — Engine using generateObject() from 'ai' + openai('gpt-4o') + Zod schemas
@lib/fred/irs/db.ts — Supabase CRUD with createClient + mapDbToResult pattern
@lib/fred/irs/index.ts — Barrel re-exports
@app/api/fred/investor-readiness/route.ts — API route with checkTierForRequest + POST/GET
@lib/api/tier-middleware.ts — checkTierForRequest, UserTier from @/lib/constants
@lib/db/migrations/025_investor_readiness_scores.sql — Migration pattern
@app/dashboard/investor-readiness/page.tsx — Dashboard page pattern (loading/error/result states)
@app/dashboard/strategy/page.tsx — EXISTING SEMI-MOCK to replace (has type cards, table, preview but calls wrong /api/documents endpoint)
@lib/constants.ts — UserTier enum, brand colors (#ff6a1a)
@components/irs/score-gauge.tsx — Component style reference (framer-motion, Tailwind, shadcn/ui)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Strategy Module -- Types, 5 Templates, Generator, DB, Export, Migration</name>
  <files>
    lib/db/migrations/027_strategy_documents.sql
    lib/fred/strategy/types.ts
    lib/fred/strategy/templates/executive-summary.ts
    lib/fred/strategy/templates/market-analysis.ts
    lib/fred/strategy/templates/30-60-90-plan.ts
    lib/fred/strategy/templates/competitive-analysis.ts
    lib/fred/strategy/templates/gtm-plan.ts
    lib/fred/strategy/templates/index.ts
    lib/fred/strategy/generator.ts
    lib/fred/strategy/db.ts
    lib/fred/strategy/index.ts
    lib/documents/export.ts
  </files>
  <action>
    Create the entire lib/fred/strategy/ module, 5 template files, and the PDF export utility.

    **1. Migration: lib/db/migrations/027_strategy_documents.sql**
    Follow 025_investor_readiness_scores.sql pattern:
    ```sql
    CREATE TABLE IF NOT EXISTS strategy_documents (
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
      user_id UUID NOT NULL,
      type TEXT NOT NULL,
      title TEXT NOT NULL,
      content TEXT NOT NULL,
      sections JSONB NOT NULL DEFAULT '[]',
      metadata JSONB DEFAULT '{}',
      version INTEGER DEFAULT 1,
      created_at TIMESTAMPTZ DEFAULT NOW(),
      updated_at TIMESTAMPTZ DEFAULT NOW()
    );
    CREATE INDEX IF NOT EXISTS idx_strategy_docs_user ON strategy_documents(user_id);
    CREATE INDEX IF NOT EXISTS idx_strategy_docs_type ON strategy_documents(type);
    CREATE INDEX IF NOT EXISTS idx_strategy_docs_created ON strategy_documents(created_at DESC);
    ```
    Add comments explaining the columns (same style as 025).

    **2. Types: lib/fred/strategy/types.ts**
    Mirror lib/fred/irs/types.ts structure:
    ```typescript
    export type StrategyDocType = 'executive_summary' | 'market_analysis' | '30_60_90_plan' | 'competitive_analysis' | 'gtm_plan';

    export const STRATEGY_DOC_TYPES: StrategyDocType[] = [
      'executive_summary', 'market_analysis', '30_60_90_plan', 'competitive_analysis', 'gtm_plan'
    ];

    export const DOC_TYPE_LABELS: Record<StrategyDocType, string> = {
      executive_summary: 'Executive Summary',
      market_analysis: 'Market Analysis',
      '30_60_90_plan': '30-60-90 Day Plan',
      competitive_analysis: 'Competitive Analysis',
      gtm_plan: 'Go-to-Market Plan',
    };

    export const DOC_TYPE_DESCRIPTIONS: Record<StrategyDocType, string> = {
      executive_summary: 'One-page company overview for investor intros and partnerships',
      market_analysis: 'Deep dive on market opportunity, size, trends, and entry strategy',
      '30_60_90_plan': 'Prioritized action roadmap for team alignment and execution',
      competitive_analysis: 'Competitive landscape analysis and positioning strategy',
      gtm_plan: 'Go-to-market strategy with channels, pricing, and launch plan',
    };
    ```

    Also define interfaces:
    - `TemplateSection`: { title: string; prompt: string; guidelines: string; maxWords: number }
    - `StrategyTemplate`: { type: StrategyDocType; name: string; description: string; sections: TemplateSection[]; totalWordTarget: number; tone: string }
    - `GeneratedSection`: { title: string; content: string; wordCount: number }
    - `GeneratedDocument`: { id?: string; userId?: string; type: StrategyDocType; title: string; content: string; sections: GeneratedSection[]; metadata: { wordCount: number; generatedAt: Date; sectionCount: number }; version: number; createdAt?: Date; updatedAt?: Date }
    - `StrategyInput`: { type: StrategyDocType; startupName: string; industry?: string; stage?: string; description?: string; additionalContext?: string }

    **3. Templates: lib/fred/strategy/templates/*.ts**
    Each template file exports a single StrategyTemplate object. Import the type from '../types'.

    **templates/executive-summary.ts** (target ~500 words, tone: "professional, concise, compelling"):
    7 sections: Company Overview, Problem & Solution, Market Opportunity, Business Model, Traction & Milestones, Team, Funding & Use of Proceeds.
    Each section has a detailed `prompt` (e.g., "Write a 2-3 sentence company overview for {startupName}. Lead with the value proposition, not the company history.") and `guidelines` (e.g., "Keep this tight -- investors read hundreds of these. Every sentence must earn its place."). maxWords per section ~75.

    **templates/market-analysis.ts** (target ~1500 words, tone: "analytical, data-driven"):
    6 sections: Market Definition, Market Size (TAM/SAM/SOM), Market Trends & Drivers, Customer Segments, Competitive Landscape, Market Entry Strategy. maxWords per section ~250.

    **templates/30-60-90-plan.ts** (target ~1200 words, tone: "action-oriented, specific"):
    6 sections: Current State Assessment, 30-Day Priorities (Quick Wins & Foundation), 60-Day Objectives (Build & Validate), 90-Day Goals (Scale & Measure), Key Metrics to Track, Resource Requirements. maxWords per section ~200.

    **templates/competitive-analysis.ts** (target ~1200 words, tone: "strategic, objective"):
    5 sections: Competitor Overview, Feature Comparison Matrix (described textually), Positioning Analysis, Strengths & Weaknesses, Differentiation Strategy. maxWords per section ~240.

    **templates/gtm-plan.ts** (target ~1500 words, tone: "tactical, execution-focused"):
    6 sections: Target Customer Profile (ICP), Value Proposition, Channel Strategy, Pricing Strategy, Launch Plan & Timeline, Success Metrics & KPIs. maxWords per section ~250.

    **templates/index.ts:**
    ```typescript
    import type { StrategyTemplate, StrategyDocType } from '../types';
    import { executiveSummaryTemplate } from './executive-summary';
    import { marketAnalysisTemplate } from './market-analysis';
    import { plan306090Template } from './30-60-90-plan';
    import { competitiveAnalysisTemplate } from './competitive-analysis';
    import { gtmPlanTemplate } from './gtm-plan';

    export const TEMPLATES: Record<StrategyDocType, StrategyTemplate> = {
      executive_summary: executiveSummaryTemplate,
      market_analysis: marketAnalysisTemplate,
      '30_60_90_plan': plan306090Template,
      competitive_analysis: competitiveAnalysisTemplate,
      gtm_plan: gtmPlanTemplate,
    };

    export function getTemplate(type: StrategyDocType): StrategyTemplate {
      const template = TEMPLATES[type];
      if (!template) throw new Error(`Unknown document type: ${type}`);
      return template;
    }
    ```

    **4. Generator: lib/fred/strategy/generator.ts**
    Use the AI SDK pattern from IRS engine, but use `generateText` (NOT generateObject) since we want flowing prose:
    ```typescript
    import { generateText } from 'ai';
    import { openai } from '@ai-sdk/openai';
    import type { StrategyInput, GeneratedDocument, GeneratedSection, TemplateSection } from './types';
    import { DOC_TYPE_LABELS } from './types';
    import { getTemplate } from './templates';
    ```

    Export `generateDocument(input: StrategyInput): Promise<GeneratedDocument>`:
    1. `getTemplate(input.type)` to load template
    2. Build system prompt: "You are Fred Cary, serial entrepreneur and startup advisor with 40+ years of experience. You speak directly, avoid corporate jargon, and give specific actionable advice. {template.tone}. You are writing a {template.name} for {input.startupName}."
    3. For each section in template.sections, call `generateSection()` sequentially (NOT parallel -- later sections should build on earlier context for coherence). Pass previously generated section titles+summaries as context.
    4. Assemble full Markdown: `## {section.title}\n\n{section.content}` joined with double newlines
    5. Title: `${DOC_TYPE_LABELS[input.type]}: ${input.startupName}`
    6. Return GeneratedDocument with content, sections, metadata (wordCount, generatedAt, sectionCount)

    Export `generateSection(section: TemplateSection, input: StrategyInput, systemPrompt: string, previousSections: GeneratedSection[]): Promise<GeneratedSection>`:
    - Replace `{startupName}`, `{industry}`, `{stage}` placeholders in section.prompt
    - Build user prompt: section prompt + guidelines + startup context + previous section summaries for coherence
    - Call `generateText({ model: openai('gpt-4o'), system: systemPrompt, prompt: userPrompt, temperature: 0.6, maxTokens: section.maxWords * 2 })`
    - Return { title: section.title, content: result.text.trim(), wordCount: countWords(result.text) }

    Helper `countWords(text: string): number` -- split on whitespace, filter empties, return length.

    **5. Database: lib/fred/strategy/db.ts**
    Follow lib/fred/irs/db.ts pattern exactly:
    ```typescript
    import { createClient } from '@supabase/supabase-js';
    const supabase = createClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.SUPABASE_SERVICE_ROLE_KEY!);
    ```

    Functions:
    - `saveStrategyDocument(userId, doc)`: Insert, return mapped result
    - `getStrategyDocuments(userId, filters?: { type?: StrategyDocType; limit?: number })`: List newest first
    - `getStrategyDocumentById(userId, docId)`: Single doc, null if not found (PGRST116)
    - `updateStrategyDocument(userId, docId, updates: { content?, title?, sections? })`: Update, bump version, set updated_at to NOW()
    - `deleteStrategyDocument(userId, docId)`: Delete with ownership check
    - Private `mapDbToDocument(row)`: snake_case DB row to camelCase GeneratedDocument

    **6. Barrel: lib/fred/strategy/index.ts**
    ```typescript
    export * from './types';
    export { TEMPLATES, getTemplate } from './templates';
    export { generateDocument, generateSection } from './generator';
    export { saveStrategyDocument, getStrategyDocuments, getStrategyDocumentById, updateStrategyDocument, deleteStrategyDocument } from './db';
    ```

    **7. Export: lib/documents/export.ts**
    Use `@react-pdf/renderer` which is already in package.json.

    ```typescript
    import React from 'react';
    import { renderToBuffer, Document, Page, Text, View, StyleSheet } from '@react-pdf/renderer';
    ```

    Export `exportToPDF(doc: { title: string; content: string; sections: Array<{ title: string; content: string }> }): Promise<Buffer>`:
    - Create a React-PDF document component using React.createElement (not JSX -- this is a .ts file, not .tsx):
      - Page 1: Title page with doc.title centered, date, "Generated by FRED"
      - Content pages: for each section, render heading (bold, 14pt) + body text (11pt, line height 1.5)
    - StyleSheet.create with professional typography: margins 50pt, font size 11, heading size 14 bold
    - Call `renderToBuffer(documentElement)` to get PDF Buffer
    - Return the Buffer

    IMPORTANT: Since this is a .ts file (not .tsx), use React.createElement() for the PDF components, NOT JSX syntax. Alternatively, name the file export.tsx if JSX is cleaner -- either approach works as long as imports resolve correctly.

    Keep the PDF styling simple and professional. Do NOT install additional packages -- @react-pdf/renderer handles this.
  </action>
  <verify>
    ```bash
    ls lib/fred/strategy/types.ts lib/fred/strategy/templates/executive-summary.ts lib/fred/strategy/templates/market-analysis.ts lib/fred/strategy/templates/30-60-90-plan.ts lib/fred/strategy/templates/competitive-analysis.ts lib/fred/strategy/templates/gtm-plan.ts lib/fred/strategy/templates/index.ts lib/fred/strategy/generator.ts lib/fred/strategy/db.ts lib/fred/strategy/index.ts lib/documents/export.ts lib/db/migrations/027_strategy_documents.sql
    npx tsc --noEmit 2>&1 | head -30
    ```
    All 12 files must exist. TypeScript must compile cleanly.
  </verify>
  <done>
    All 12 files created. 5 template files define section structures for each document type. Generator produces multi-section markdown documents using FRED's voice via generateText. DB module does full CRUD on strategy_documents table. Export utility generates PDF via @react-pdf/renderer. Migration creates table with indexes. TypeScript compiles cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Strategy API Endpoints + UI Components + Dashboard Page</name>
  <files>
    app/api/fred/strategy/route.ts
    app/api/fred/strategy/[id]/route.ts
    app/api/fred/strategy/[id]/export/route.ts
    components/strategy/document-type-selector.tsx
    components/strategy/document-preview.tsx
    components/strategy/generation-progress.tsx
    components/strategy/document-list.tsx
    components/strategy/index.ts
    app/dashboard/strategy/page.tsx
  </files>
  <action>
    **1. API Routes**

    **app/api/fred/strategy/route.ts:**
    Follow app/api/fred/investor-readiness/route.ts pattern exactly.

    POST handler (Generate new document):
    1. `checkTierForRequest(request, UserTier.PRO)` -- return 403 `{ error: 'Pro tier required for Strategy Documents' }` if not allowed
    2. Get `userId` from `tierCheck.user!.id`
    3. Parse body: `{ type, startupName, industry?, stage?, description?, additionalContext? }`
    4. Validate: `type` must be one of STRATEGY_DOC_TYPES (return 400 if not), `startupName` must be non-empty (return 400 if missing)
    5. Build StrategyInput: `{ type, startupName, industry, stage, description, additionalContext }`
    6. Call `generateDocument(input)` from `@/lib/fred/strategy`
    7. Call `saveStrategyDocument(userId, document)` from `@/lib/fred/strategy`
    8. Return `{ success: true, document: savedDoc }`
    9. Try/catch with `console.error('[Strategy API]', error)`, return 500

    GET handler (List documents):
    1. Same tier check pattern
    2. Parse searchParams: `type` (optional StrategyDocType filter), `limit` (optional, default 20)
    3. Call `getStrategyDocuments(userId, { type, limit })`
    4. Return `{ success: true, documents, count: documents.length }`

    **app/api/fred/strategy/[id]/route.ts:**
    Three handlers, all with Pro tier gating via checkTierForRequest.

    IMPORTANT: In Next.js 16 App Router, the second argument is `{ params }: { params: Promise<{ id: string }> }`. Use `const { id } = await params;`

    GET:
    1. Tier check, extract id from `await params`
    2. `getStrategyDocumentById(userId, id)` -- 404 if null
    3. Return `{ success: true, document }`

    PUT:
    1. Tier check, extract id
    2. Parse body: `{ content?, title?, sections? }`
    3. `updateStrategyDocument(userId, id, body)` -- catch not-found errors
    4. Return `{ success: true, document: updated }`

    DELETE:
    1. Tier check, extract id
    2. `deleteStrategyDocument(userId, id)`
    3. Return `{ success: true }`

    **app/api/fred/strategy/[id]/export/route.ts:**
    GET handler:
    1. Tier check (Pro)
    2. Extract id from `await params`
    3. `getStrategyDocumentById(userId, id)` -- 404 if null
    4. Call `exportToPDF({ title: doc.title, content: doc.content, sections: doc.sections })`
    5. Return:
    ```typescript
    return new NextResponse(pdfBuffer, {
      headers: {
        'Content-Type': 'application/pdf',
        'Content-Disposition': `attachment; filename="${doc.title.replace(/[^a-zA-Z0-9-_ ]/g, '').replace(/\s+/g, '-').toLowerCase()}.pdf"`,
      },
    });
    ```

    **2. UI Components under components/strategy/**

    **components/strategy/document-type-selector.tsx** -- "use client"
    Props: `{ onSelect: (type: StrategyDocType) => void; selectedType: StrategyDocType | null; disabled?: boolean }`
    - Import STRATEGY_DOC_TYPES, DOC_TYPE_LABELS, DOC_TYPE_DESCRIPTIONS from `@/lib/fred/strategy/types`
    - Import icons from lucide-react: FileText, TrendingUp, Calendar, Target, Rocket
    - Map doc types to icons: executive_summary->FileText, market_analysis->TrendingUp, 30_60_90_plan->Calendar, competitive_analysis->Target, gtm_plan->Rocket
    - Grid: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`
    - Each card: icon in orange circle background, label, description, clickable whole card
    - Selected card: `ring-2 ring-[#ff6a1a] bg-orange-50 dark:bg-orange-950/20`
    - Disabled state: `opacity-50 pointer-events-none`

    **components/strategy/generation-progress.tsx** -- "use client"
    Props: `{ sectionNames: string[]; currentSection: number; isGenerating: boolean }`
    - Vertical stepper showing section names
    - Completed sections: green CheckCircle2 icon + strikethrough-free text
    - Current section: orange circle with Loader2 spinner animation + bold text
    - Pending sections: gray circle + gray text
    - Overall progress bar at bottom: `currentSection / sectionNames.length * 100` percent
    - "FRED is writing..." text at top when isGenerating

    **components/strategy/document-list.tsx** -- "use client"
    Props: `{ documents: GeneratedDocument[]; onView: (id: string) => void; onDelete: (id: string) => void; onExport: (id: string) => void }`
    - Import DOC_TYPE_LABELS from `@/lib/fred/strategy/types`
    - Card-based layout (not table -- more visual, consistent with existing UI)
    - Each card: title (bold), type badge (colored pill), word count, created date (relative: "2 hours ago")
    - Action buttons: View (eye icon), Export PDF (download icon), Delete (trash icon, red on hover)
    - Delete confirmation: `window.confirm('Delete this document?')` before calling onDelete
    - Empty state: "No strategy documents yet. Choose a type above to generate your first."
    - Sort: newest first (already sorted by API)

    **components/strategy/document-preview.tsx** -- "use client"
    Props: `{ document: GeneratedDocument; onExport: () => void; onClose: () => void }`
    - Document title as h2 with type badge
    - Metadata: word count, version number, generated date
    - Content rendered with preserved whitespace and proper heading styling:
      - Split content by `## ` headers
      - Render each section with h3 heading (font-bold text-lg) + body paragraphs
    - Action buttons at top: "Download PDF" (orange button), "Close" (outline button)
    - Use Card wrapper from @/components/ui/card

    **components/strategy/index.ts:**
    ```typescript
    export { DocumentTypeSelector } from './document-type-selector';
    export { GenerationProgress } from './generation-progress';
    export { DocumentList } from './document-list';
    export { DocumentPreview } from './document-preview';
    ```

    **3. Dashboard Page: app/dashboard/strategy/page.tsx**
    REPLACE the entire existing semi-mock page. "use client" component.

    State:
    - `documents`: GeneratedDocument[] (user's strategy docs)
    - `selectedType`: StrategyDocType | null (for generation)
    - `selectedDoc`: GeneratedDocument | null (for viewing)
    - `generating`: boolean
    - `currentSection`: number (for progress display)
    - `loading`: boolean (initial fetch)
    - `error`: string | null
    - Form state: `startupName`, `industry`, `stage`, `description` (simple strings)

    On mount (useEffect):
    - GET `/api/fred/strategy` to fetch existing documents, set documents state
    - Handle 403 gracefully (show error state or redirect)

    Header (same pattern as investor-readiness page):
    - ArrowLeft back link to /dashboard
    - Title: "Strategy Documents"
    - Subtitle: "AI-generated strategic documents tailored to your startup"
    - Pro badge (orange pill)

    Section 1 -- "Generate New Document":
    - DocumentTypeSelector component
    - When type is selected, reveal a compact form below the selector:
      - Startup Name (Input, required, placeholder "Your startup name")
      - Industry (Input, placeholder "e.g., SaaS, FinTech, HealthTech")
      - Stage (select element with options: idea, pre-seed, seed, series-a, series-b+)
      - Brief Description (Textarea, 2 rows, placeholder "What does your startup do?")
    - "Generate {DOC_TYPE_LABELS[type]}" button (orange, full width)
    - While generating: replace the form with GenerationProgress component. To show section progress, use the template's section names. Simulate visual progress: increment currentSection on a 4-second interval (document generation takes ~30-60s for 5-7 sections, so ~5s per section is realistic).

    Generation flow:
    1. User clicks generate
    2. Set generating=true, start section progress simulation
    3. POST to `/api/fred/strategy` with { type, startupName, industry, stage, description }
    4. On success: clear generating, add returned document to documents list, set selectedDoc to show preview
    5. On error: clear generating, show error toast via console or alert

    Section 2 -- "Your Documents":
    - DocumentList component
    - Click "View": set selectedDoc and show DocumentPreview
    - Click "Export": trigger download via `window.open('/api/fred/strategy/${id}/export?format=pdf')`
    - Click "Delete": DELETE to `/api/fred/strategy/${id}`, remove from documents state

    Document Preview:
    - Show DocumentPreview when selectedDoc is set
    - "Download PDF" triggers same export as above
    - "Close" clears selectedDoc

    Style consistency:
    - Brand orange #ff6a1a for primary buttons: `className="bg-[#ff6a1a] hover:bg-[#ea580c] text-white"`
    - Use Card, Button, Input, Textarea from @/components/ui/*
    - Loading state: Loader2 spinner centered
    - Error state: AlertCircle with red banner (same as investor-readiness page)
  </action>
  <verify>
    ```bash
    ls app/api/fred/strategy/route.ts
    ls app/api/fred/strategy/\[id\]/route.ts
    ls app/api/fred/strategy/\[id\]/export/route.ts
    ls components/strategy/document-type-selector.tsx components/strategy/document-preview.tsx components/strategy/generation-progress.tsx components/strategy/document-list.tsx components/strategy/index.ts
    ls app/dashboard/strategy/page.tsx
    npx tsc --noEmit 2>&1 | head -30
    grep -l "checkTierForRequest" app/api/fred/strategy/route.ts
    grep -l "generateDocument" app/api/fred/strategy/route.ts
    grep -l "exportToPDF" app/api/fred/strategy/\[id\]/export/route.ts
    ```
    All files exist. TypeScript compiles. API routes use tier middleware and call generator/export. Dashboard fetches from correct API.
  </verify>
  <done>
    POST /api/fred/strategy generates documents with Pro tier gating. GET lists documents. PUT/DELETE for individual documents. Export endpoint returns PDF buffer. Dashboard at /dashboard/strategy provides full workflow: select document type, fill in startup info, generate with progress indicator, view document list, preview documents, export PDF. Semi-mock page is fully replaced with functional implementation.
  </done>
</task>

</tasks>

<verification>
1. `ls lib/fred/strategy/` shows: types.ts, templates/ (with 5 template files + index.ts), generator.ts, db.ts, index.ts
2. `ls app/api/fred/strategy/` shows: route.ts, [id]/route.ts, [id]/export/route.ts
3. `ls components/strategy/` shows: document-type-selector.tsx, document-preview.tsx, generation-progress.tsx, document-list.tsx, index.ts
4. `ls app/dashboard/strategy/page.tsx` exists (no longer semi-mock)
5. `ls lib/documents/export.ts` exists
6. `ls lib/db/migrations/027_strategy_documents.sql` exists
7. `npx tsc --noEmit` passes
8. `grep -r "checkTierForRequest" app/api/fred/strategy/` shows tier checks in all 3 route files
9. `grep -r "generateDocument" app/api/fred/strategy/route.ts` confirms generator wiring
10. `grep -r "generateText" lib/fred/strategy/generator.ts` confirms AI integration
11. `grep -r "exportToPDF" app/api/fred/strategy/[id]/export/route.ts` confirms export wiring
12. `grep -r "renderToBuffer" lib/documents/export.ts` confirms @react-pdf usage
13. Template count: `ls lib/fred/strategy/templates/*.ts | wc -l` returns 6 (5 templates + index)
</verification>

<success_criteria>
- lib/fred/strategy/ module exists with types, 5 template files, generator, db, barrel
- 5 templates: executive_summary, market_analysis, 30_60_90_plan, competitive_analysis, gtm_plan
- Generator produces multi-section markdown via generateText with FRED's voice (Fred Cary persona)
- API: POST /api/fred/strategy generates documents with Pro tier gating
- API: GET /api/fred/strategy lists documents with optional type filter
- API: GET/PUT/DELETE /api/fred/strategy/[id] for CRUD
- API: GET /api/fred/strategy/[id]/export returns PDF
- Export: lib/documents/export.ts uses @react-pdf/renderer
- Database: strategy_documents table with sections JSONB, version, timestamps
- Dashboard: /dashboard/strategy provides type selection, startup info form, generation with progress, document list, preview, and PDF export
- Semi-mock page fully replaced with functional implementation
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-pro-tier/03-07-SUMMARY.md`
</output>
