# Plan 03-04: Strategy Document Generation

**Status:** COMPLETED
**Phase:** 03 - Pro Tier Features
**Depends On:** 03-01 (PDF Pipeline), 02-02 (FRED Chat)
**Estimated Complexity:** Medium

---

## Objective

Create a strategy document generation system that:
1. Generates professional strategy documents
2. Uses FRED's voice and startup context
3. Produces actionable, specific content
4. Supports multiple document types
5. Allows export to PDF/DOCX

---

## Current State Analysis

**Existing:**
- FRED cognitive framework
- Startup info from onboarding
- Document storage (03-01)
- Memory system for context

**Missing:**
- Document templates
- Generation prompts
- Export functionality
- Preview/edit UI

---

## Document Types

| Type | Description | Use Case |
|------|-------------|----------|
| Executive Summary | 1-page company overview | Investor intros, partnerships |
| Market Analysis | Deep dive on market opportunity | Strategic planning, pitches |
| 30-60-90 Day Plan | Prioritized action roadmap | Team alignment, investor updates |
| Competitive Analysis | Landscape and positioning | Strategy, pitch preparation |
| Go-to-Market Plan | GTM strategy details | Team execution, investor materials |

---

## Implementation Steps

### Step 1: Create Strategy Document Schema

**File:** `lib/db/migrations/012_strategy_documents.sql`

```sql
-- Generated strategy documents
CREATE TABLE strategy_documents (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  type TEXT NOT NULL, -- 'executive_summary', 'market_analysis', etc.
  title TEXT NOT NULL,
  content TEXT NOT NULL, -- Markdown content
  metadata JSONB DEFAULT '{}',
  version INTEGER DEFAULT 1,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_strategy_docs_user ON strategy_documents(user_id);
CREATE INDEX idx_strategy_docs_type ON strategy_documents(type);
```

### Step 2: Create Document Templates

**File:** `lib/fred/strategy/templates/executive-summary.ts`

```typescript
const executiveSummaryTemplate = {
  sections: [
    { title: 'Company Overview', prompt: '...' },
    { title: 'Problem & Solution', prompt: '...' },
    { title: 'Market Opportunity', prompt: '...' },
    { title: 'Business Model', prompt: '...' },
    { title: 'Traction & Milestones', prompt: '...' },
    { title: 'Team', prompt: '...' },
    { title: 'Funding & Use of Proceeds', prompt: '...' },
  ],
  wordCount: 500,
  tone: 'professional, concise, compelling',
};
```

**File:** `lib/fred/strategy/templates/market-analysis.ts`

Sections:
- Market Definition
- Market Size (TAM/SAM/SOM)
- Market Trends
- Customer Segments
- Competitive Landscape
- Market Entry Strategy

**File:** `lib/fred/strategy/templates/30-60-90-plan.ts`

Sections:
- Current State Assessment
- 30-Day Priorities
- 60-Day Objectives
- 90-Day Goals
- Key Metrics to Track
- Resource Requirements

**File:** `lib/fred/strategy/templates/competitive-analysis.ts`

Sections:
- Competitor Overview
- Feature Comparison
- Positioning Map
- Strengths & Weaknesses
- Differentiation Strategy

**File:** `lib/fred/strategy/templates/gtm-plan.ts`

Sections:
- Target Customer Profile
- Value Proposition
- Channels Strategy
- Pricing Strategy
- Launch Plan
- Success Metrics

### Step 3: Create Strategy Generator

**File:** `lib/fred/strategy-generator.ts`

```typescript
interface GeneratorInput {
  type: DocumentType;
  startupInfo: StartupInfo;
  additionalContext?: string;
  uploadedDocuments?: Document[];
}

interface GeneratedDocument {
  title: string;
  content: string;
  sections: Section[];
  metadata: {
    wordCount: number;
    generatedAt: Date;
    context: string[];
  };
}
```

Key functions:
- `generateDocument(input: GeneratorInput): Promise<GeneratedDocument>`
- `generateSection(template, context): Promise<string>`
- `assembleDocument(sections, template): string`

### Step 4: Create Strategy API Endpoints

**File:** `app/api/fred/strategy/route.ts`

```typescript
// POST /api/fred/strategy
// - Require Pro tier
// - Accept document type and context
// - Generate document
// - Store result
// - Return document

// GET /api/fred/strategy
// - List user's generated documents
```

**File:** `app/api/fred/strategy/[id]/route.ts`

```typescript
// GET - Get specific document
// PUT - Update document content
// DELETE - Delete document
```

### Step 5: Create Export Functionality

**File:** `lib/documents/export.ts`

```typescript
// Export to PDF using @react-pdf/renderer or similar
// Export to DOCX using docx package
// Maintain formatting and structure
```

Key functions:
- `exportToPDF(document): Promise<Buffer>`
- `exportToDOCX(document): Promise<Buffer>`

**File:** `app/api/fred/strategy/[id]/export/route.ts`

```typescript
// GET /api/fred/strategy/[id]/export?format=pdf
// GET /api/fred/strategy/[id]/export?format=docx
```

### Step 6: Create Strategy Page

**File:** `app/dashboard/strategy/page.tsx`

Layout:
- Document type selector
- Generate button
- Document list
- Preview/edit panel

### Step 7: Create Strategy UI Components

**File:** `components/strategy/document-type-selector.tsx`

Features:
- Card for each document type
- Description and use case
- Estimated generation time
- Prerequisites indicator

**File:** `components/strategy/document-editor.tsx`

Features:
- Markdown preview
- Section-by-section editing
- Regenerate section button
- Save changes

**File:** `components/strategy/document-preview.tsx`

Features:
- Formatted preview
- Section navigation
- Print-friendly view
- Export buttons

**File:** `components/strategy/document-list.tsx`

Features:
- Document cards
- Type icons
- Created date
- Quick actions (view, export, delete)

### Step 8: Create Generation Progress UI

**File:** `components/strategy/generation-progress.tsx`

Features:
- Section-by-section progress
- FRED "thinking" animation
- Estimated time remaining
- Cancel option

---

## Generation Prompts

### Executive Summary Prompt
```
You are Fred Cary, an expert startup advisor. Generate an executive summary for {startupName}.

Context:
- Industry: {industry}
- Stage: {stage}
- Main challenge: {challenge}

The executive summary should be:
- Professional and investor-ready
- Concise (approximately 500 words)
- Compelling with clear value proposition
- Data-driven where possible

Include these sections:
1. Company Overview
2. Problem & Solution
3. Market Opportunity
4. Business Model
5. Traction
6. Team
7. Ask

Use my direct, no-BS voice. Be specific, not generic.
```

---

## Testing

- [ ] All document types generate correctly
- [ ] Content is specific to startup context
- [ ] FRED voice is consistent
- [ ] PDF export maintains formatting
- [ ] DOCX export works correctly
- [ ] Documents stored and retrievable
- [ ] Pro tier requirement enforced

---

## Verification

- [ ] Generate each document type
- [ ] Verify content quality
- [ ] Test export to PDF
- [ ] Test export to DOCX
- [ ] Edit and save changes
- [ ] Delete document

---

*Plan file for GSD framework*
