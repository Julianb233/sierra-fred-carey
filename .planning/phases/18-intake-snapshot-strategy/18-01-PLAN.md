---
phase: 18-intake-snapshot-strategy
plan: 01
type: execute
wave: 2
depends_on: []
files_modified:
  - components/onboarding/startup-info-step.tsx
  - lib/hooks/use-onboarding.ts
  - app/api/onboard/route.ts
  - lib/db/migrations/037_enriched_profiles.sql
  - app/dashboard/profile/snapshot/page.tsx
  - app/api/dashboard/profile/snapshot/route.ts
autonomous: true

must_haves:
  truths:
    - "Onboarding startup-info-step captures industry, revenue range, team size, and funding history"
    - "use-onboarding hook extends StartupInfo type with new fields"
    - "Onboard API persists enriched fields to profiles table"
    - "Migration 037 adds industry, revenue_range, team_size, funding_history, and enrichment columns to profiles"
    - "Snapshot page at /dashboard/profile/snapshot displays the founder's current profile data"
    - "Snapshot API returns the full enriched profile for the authenticated user"
  artifacts:
    - path: "components/onboarding/startup-info-step.tsx"
      provides: "Enriched onboarding step with industry, revenue, team size, funding fields"
    - path: "lib/hooks/use-onboarding.ts"
      provides: "Extended StartupInfo type with new fields"
      contains: "industry"
    - path: "lib/db/migrations/037_enriched_profiles.sql"
      provides: "Profile enrichment columns migration"
    - path: "app/dashboard/profile/snapshot/page.tsx"
      provides: "Founder profile snapshot display page"
    - path: "app/api/dashboard/profile/snapshot/route.ts"
      provides: "GET endpoint returning enriched founder profile"
  key_links:
    - from: "components/onboarding/startup-info-step.tsx"
      to: "lib/hooks/use-onboarding.ts"
      via: "uses extended StartupInfo type for form state"
      pattern: "StartupInfo"
    - from: "app/api/onboard/route.ts"
      to: "lib/db/migrations/037_enriched_profiles.sql"
      via: "persists enriched fields to profiles table"
      pattern: "industry.*revenue_range.*team_size"
    - from: "app/dashboard/profile/snapshot/page.tsx"
      to: "app/api/dashboard/profile/snapshot/route.ts"
      via: "fetches profile data from snapshot API"
      pattern: "/api/dashboard/profile/snapshot"
---

<objective>
Enrich the onboarding questionnaire with additional founder profile fields and create a viewable profile snapshot page.

Purpose: The current onboarding captures only startup name, stage, and challenges. This plan adds industry, revenue range, team size, and funding history to create a richer founder profile. A new snapshot page displays this data in a structured format, giving founders a clear view of their profile as FRED sees it.

Output: 1 new migration, 1 new page, 1 new API route, 3 modified files (onboarding step, hook, onboard API). No new npm dependencies.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

Key source files (READ ALL BEFORE MODIFYING):
@components/onboarding/startup-info-step.tsx (current onboarding fields)
@lib/hooks/use-onboarding.ts (StartupInfo type and hook)
@app/api/onboard/route.ts (onboarding persistence endpoint)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enriched onboarding and database</name>
  <files>
    lib/db/migrations/037_enriched_profiles.sql
    lib/hooks/use-onboarding.ts
    components/onboarding/startup-info-step.tsx
    app/api/onboard/route.ts
  </files>
  <action>
**Step 1: Create migration `lib/db/migrations/037_enriched_profiles.sql`**

Add columns to the profiles table:
```sql
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS industry text;
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS revenue_range text; -- e.g., "pre-revenue", "$0-10k", "$10k-50k", "$50k-100k", "$100k-500k", "$500k+"
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS team_size integer;
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS funding_history text; -- e.g., "bootstrapped", "friends-family", "angel", "seed", "series-a"
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS enriched_at timestamptz;
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS enrichment_source text; -- "onboarding" or "conversation"
```

**Step 2: Extend StartupInfo in `lib/hooks/use-onboarding.ts`**

Add optional fields to the StartupInfo type/interface:
```typescript
industry?: string;
revenueRange?: string;
teamSize?: number;
fundingHistory?: string;
```

Update the initial state to include these fields with empty/undefined defaults. Do NOT change any existing fields or hook logic.

**Step 3: Add fields to `components/onboarding/startup-info-step.tsx`**

After the existing fields (startup name, stage, challenges), add:
1. **Industry** -- Select dropdown with common startup industries: "SaaS", "E-commerce", "FinTech", "HealthTech", "EdTech", "Marketplace", "Consumer", "Enterprise", "AI/ML", "Hardware", "Other"
2. **Revenue Range** -- Select dropdown: "Pre-revenue", "$0 - $10K/mo", "$10K - $50K/mo", "$50K - $100K/mo", "$100K - $500K/mo", "$500K+/mo"
3. **Team Size** -- Number input (min 1, max 500) with label "How many people on your team?"
4. **Funding History** -- Select dropdown: "Bootstrapped", "Friends & Family", "Angel Round", "Seed Round", "Series A+", "Revenue-funded"

All new fields are optional -- they should not block onboarding completion. Use the same form styling as existing fields. Wire values through the use-onboarding hook's state management.

**Step 4: Persist in `app/api/onboard/route.ts`**

When saving the startup info to the profiles table, include the new fields:
- Map `startupInfo.industry` -> `industry`
- Map `startupInfo.revenueRange` -> `revenue_range`
- Map `startupInfo.teamSize` -> `team_size`
- Map `startupInfo.fundingHistory` -> `funding_history`
- Set `enriched_at` to `new Date().toISOString()` and `enrichment_source` to `'onboarding'`

IMPORTANT: Do NOT modify existing onboarding logic or validation. Only ADD the new field persistence alongside existing fields.
  </action>
  <verify>
1. `test -f lib/db/migrations/037_enriched_profiles.sql` -- migration exists
2. `grep 'industry\|revenueRange\|teamSize\|fundingHistory' lib/hooks/use-onboarding.ts` -- fields in hook
3. `grep 'industry\|revenue' components/onboarding/startup-info-step.tsx` -- fields in form
4. `grep 'industry\|revenue_range\|team_size' app/api/onboard/route.ts` -- fields persisted
5. `npx tsc --noEmit` passes with no errors
  </verify>
  <done>
Migration 037 adds enrichment columns to profiles. use-onboarding hook extends StartupInfo with 4 new fields. Onboarding form adds industry, revenue, team size, and funding dropdowns. Onboard API persists all new fields.
  </done>
</task>

<task type="auto">
  <name>Task 2: Snapshot page and API</name>
  <files>
    app/dashboard/profile/snapshot/page.tsx
    app/api/dashboard/profile/snapshot/route.ts
  </files>
  <action>
**Step 1: Create `app/api/dashboard/profile/snapshot/route.ts`**

GET endpoint:
1. Authenticate user via Supabase server client
2. Query profiles table for the user's row, selecting all relevant columns: startup_name, stage, challenges, industry, revenue_range, team_size, funding_history, enriched_at, enrichment_source, created_at
3. Return JSON with camelCase mapped fields
4. Return 401 if not authenticated, 404 if no profile found

**Step 2: Create `app/dashboard/profile/snapshot/page.tsx`**

"use client" page at /dashboard/profile/snapshot:
- Fetch profile data from GET /api/dashboard/profile/snapshot on mount
- Display in a structured card layout:
  - **Header**: "Founder Profile Snapshot" with last-updated timestamp
  - **Startup Info section**: Name, stage, industry (with fallback "Not specified")
  - **Financials section**: Revenue range, funding history
  - **Team section**: Team size
  - **Challenges section**: Display challenges list
  - **Enrichment status**: Show enrichment source (onboarding vs conversation) and date
- Empty fields show "Not yet captured" in muted text
- "Edit Profile" link to /onboarding or /settings for updating
- Responsive card grid matching dashboard styling
- Loading skeleton and error states
  </action>
  <verify>
1. `test -f app/api/dashboard/profile/snapshot/route.ts` -- API exists
2. `test -f app/dashboard/profile/snapshot/page.tsx` -- page exists
3. `grep 'snapshot' app/api/dashboard/profile/snapshot/route.ts` -- route handler present
4. `npx tsc --noEmit` passes with no errors
  </verify>
  <done>
Snapshot API returns enriched founder profile data. Snapshot page at /dashboard/profile/snapshot displays structured profile with all fields, enrichment status, and edit links.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Migration exists:**
   ```bash
   test -f lib/db/migrations/037_enriched_profiles.sql && echo "EXISTS"
   grep 'industry' lib/db/migrations/037_enriched_profiles.sql
   ```

2. **Onboarding enriched:**
   ```bash
   grep 'industry' components/onboarding/startup-info-step.tsx lib/hooks/use-onboarding.ts
   ```

3. **Snapshot route exists:**
   ```bash
   test -f app/dashboard/profile/snapshot/page.tsx && test -f app/api/dashboard/profile/snapshot/route.ts && echo "EXISTS"
   ```

4. **TypeScript compiles:**
   ```bash
   npx tsc --noEmit
   ```
</verification>

<success_criteria>
- Onboarding captures industry, revenue range, team size, and funding history
- All new fields are optional and do not block onboarding completion
- Migration 037 adds enrichment columns to profiles table
- Onboard API persists new fields alongside existing ones
- Snapshot page displays all profile data in a structured layout
- Snapshot API returns full enriched profile for authenticated user
- No existing onboarding logic or validation modified
- TypeScript compiles with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-intake-snapshot-strategy/18-01-SUMMARY.md`
</output>
