# Plan 02-01: Reality Lens 5-Factor Assessment Engine

**Status:** COMPLETED
**Phase:** 02 - Free Tier Features
**Depends On:** Phase 01 (FRED Cognitive Engine)
**Estimated Complexity:** Medium

---

## Objective

Implement the Reality Lens assessment engine that evaluates startup ideas/pivots across 5 key factors, providing founders with a clear-eyed view of their venture's viability.

---

## Context

From research: Reality Lens is a "table stakes" feature for the free tier. It provides a 5-factor assessment to help founders evaluate their ideas objectively:

1. **Feasibility** - Can this actually be built with available resources?
2. **Economics** - Do the unit economics work? Is it fundable?
3. **Demand** - Is there real market demand? Evidence of willingness to pay?
4. **Distribution** - Can you reach customers? What channels exist?
5. **Timing** - Is the market ready? Too early/late?

Each factor scores 0-100 with detailed breakdown and recommendations.

---

## Implementation Summary

### 1. Reality Lens Schemas (`lib/fred/schemas/reality-lens.ts`)

Comprehensive Zod schemas for:
- `RealityLensInputSchema` - Validates idea description and optional context
- `RealityLensContextSchema` - Stage, funding, team size, industry, MRR, etc.
- `FactorAssessmentSchema` - Score, confidence, strengths, weaknesses, recommendations
- `RealityLensResultSchema` - Complete assessment result with metadata

Helper functions:
- `getVerdictFromScore()` - Maps score to verdict
- `calculateOverallScore()` - Weighted average of factor scores

### 2. Reality Lens Engine (`lib/fred/reality-lens.ts`)

Core `assessIdea()` function:
- Takes startup idea + optional context
- Assesses all 5 factors in parallel using AI structured generation
- Falls back to heuristic assessment on AI failure
- Calculates weighted overall score
- Synthesizes top-level insights (strengths, risks, next steps)
- Returns comprehensive RealityLensResult

### 3. API Endpoint (`app/api/fred/reality-lens/route.ts`)

**POST /api/fred/reality-lens**
- Authenticated endpoint requiring user login
- Rate limited by tier:
  - Free: 5/day
  - Pro: 50/day
  - Studio: 500/day
- Returns full assessment result with metadata

**GET /api/fred/reality-lens**
- Returns API documentation and factor descriptions
- Shows user's current rate limit status

### 4. Factor Weights

| Factor | Weight | Rationale |
|--------|--------|-----------|
| Demand | 25% | Most critical - no demand = no business |
| Economics | 25% | Must be financially viable |
| Feasibility | 20% | Can you actually build it? |
| Distribution | 15% | How will you reach customers? |
| Timing | 15% | Market readiness |

### 5. Verdict Thresholds

| Verdict | Score Range | Description |
|---------|-------------|-------------|
| strong | 80-100 | Strong foundation, proceed confidently |
| promising | 60-79 | Good potential, address weaknesses |
| needs-work | 40-59 | Significant concerns to resolve |
| reconsider | 0-39 | Fundamental issues, pivot recommended |

---

## Implementation Tasks

- [x] Create Reality Lens schemas (`lib/fred/schemas/reality-lens.ts`)
- [x] Implement factor assessment prompts
- [x] Create Reality Lens engine (`lib/fred/reality-lens.ts`)
- [x] Build API endpoint with rate limiting
- [x] Write comprehensive tests
- [x] Update exports

---

## Testing

### Tests Created (`lib/fred/__tests__/reality-lens.test.ts`)

38 tests covering:
- Schema validation (input, context, factor assessment)
- Score calculations and weighted averages
- Verdict determination at boundary values
- Factor weight verification
- Input validation function
- Full assessment flow with heuristics

### All Tests Pass
- 38 new Reality Lens tests
- 431 total tests passing

---

## Files Created

| File | Description |
|------|-------------|
| `lib/fred/schemas/reality-lens.ts` | Zod schemas for input/output |
| `lib/fred/schemas/index.ts` | Schema exports |
| `lib/fred/reality-lens.ts` | Core assessment engine |
| `app/api/fred/reality-lens/route.ts` | API endpoint |
| `lib/fred/__tests__/reality-lens.test.ts` | Tests |

## Files Modified

| File | Changes |
|------|---------|
| `lib/fred/index.ts` | Export Reality Lens module |

---

## Verification

- [x] Assessment completes in < 15 seconds (heuristics: ~2ms)
- [x] All 5 factors scored with explanations
- [x] Verdict aligns with factor scores
- [x] Recommendations are actionable
- [x] Rate limiting enforced correctly
- [x] Tests pass (38 tests > 20 target)

---

## Usage Example

```typescript
import { assessIdea } from "@/lib/fred";

const result = await assessIdea({
  idea: "An AI-powered tool that helps founders make better business decisions...",
  context: {
    stage: "mvp",
    funding: "pre-seed",
    teamSize: 3,
  },
});

console.log(result.overallScore); // 72
console.log(result.verdict); // "promising"
console.log(result.factors.demand.score); // 75
console.log(result.nextSteps); // ["Focus on customer discovery", ...]
```

---

*Plan created: 2026-02-05*
*Completed: 2026-02-05*
