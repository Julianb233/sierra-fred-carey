# Plan 02-02: FRED Chat Interface with Cognitive Framework Compliance

**Status:** COMPLETED
**Phase:** 02 - Free Tier Features
**Depends On:** 01-05 (FRED API Endpoints)
**Estimated Complexity:** Medium

---

## Objective

Build a full-featured chat interface for FRED that:
- Displays cognitive processing stages in real-time
- Shows confidence levels and reasoning
- Supports SSE streaming for responsive UX
- Maintains session persistence
- Complies with FRED's cognitive framework

---

## Implementation Summary

### 1. React Hook (`lib/hooks/use-fred-chat.ts`)

Full-featured hook for FRED chat integration:

**State Management:**
- `messages` - Conversation history
- `state` - Current cognitive state (idle, connecting, analyzing, applying_models, synthesizing, deciding, complete, error)
- `analysis` - Latest intent detection results
- `synthesis` - Latest synthesis results
- `error` - Error state with recovery

**Features:**
- SSE streaming for real-time updates
- Session persistence via sessionStorage
- AbortController for request cancellation
- Automatic state mapping from server states
- Context support for startup information
- Memory storage toggle

**API:**
```typescript
const {
  messages,
  sendMessage,
  state,
  isProcessing,
  sessionId,
  analysis,
  synthesis,
  error,
  clearError,
  reset,
} = useFredChat({ context, storeInMemory: true });
```

### 2. Chat Components

**`components/chat/chat-interface.tsx`**
- Main chat container with message list
- Auto-scroll to latest message
- Cognitive state indicator integration
- Welcome message from Fred Cary
- Floating orbs background (brand styling)

**`components/chat/chat-message.tsx`**
- User/assistant message differentiation
- Confidence badges (high/medium/low)
- Action suggestions with approval badges
- Expandable reasoning section
- Timestamps with relative formatting
- Glassmorphism styling

**`components/chat/chat-input.tsx`**
- Auto-resize textarea
- Enter to send, Shift+Enter for newline
- Loading state with spinner
- Gradient glow effects

**`components/chat/typing-indicator.tsx`**
- Animated dots while processing
- Smooth enter/exit animations

**`components/chat/cognitive-state-indicator.tsx`**
Three display variants:
1. `CognitiveStateIndicator` - Pill with description
2. `CognitiveStateBadge` - Compact inline badge
3. `CognitiveStepIndicator` - Step progress (Analyze → Think → Synthesize → Respond)

### 3. Chat Page (`app/chat/page.tsx`)

Full-page chat experience:
- Responsive header with back navigation
- Multi-layer animated background
- Mobile-optimized layout
- Brand-consistent styling

---

## Cognitive Framework Compliance

The interface surfaces FRED's cognitive process:

| State | Display | What's Happening |
|-------|---------|------------------|
| connecting | "Connecting" | Establishing SSE connection |
| analyzing | "Analyzing" | INTAKE → VALIDATION (intent, entities) |
| applying_models | "Thinking" | MENTAL_MODELS (first principles, etc.) |
| synthesizing | "Synthesizing" | SYNTHESIS (recommendation forming) |
| deciding | "Deciding" | DECIDE (finalizing response) |
| complete | Hidden | Response delivered |

Each message includes:
- **Confidence level** - How certain FRED is
- **Suggested action** - What FRED recommends
- **Requires approval** - Whether user confirmation needed
- **Reasoning** - Expandable explanation

---

## Files

| File | Description |
|------|-------------|
| `lib/hooks/use-fred-chat.ts` | React hook for FRED chat |
| `components/chat/chat-interface.tsx` | Main chat container |
| `components/chat/chat-message.tsx` | Message component |
| `components/chat/chat-input.tsx` | Input component |
| `components/chat/typing-indicator.tsx` | Loading animation |
| `components/chat/cognitive-state-indicator.tsx` | State display variants |
| `app/chat/page.tsx` | Chat page route |

---

## Verification

- [x] Chat interface renders correctly
- [x] SSE streaming works with state updates
- [x] Cognitive states displayed during processing
- [x] Confidence levels shown on responses
- [x] Reasoning expandable on messages
- [x] Session persists across page reloads
- [x] Mobile-responsive layout
- [x] Brand styling consistent

---

## Usage

```tsx
// Simple usage
import { ChatInterface } from "@/components/chat/chat-interface";

<ChatInterface />

// With context
<ChatInterface
  context={{
    startupName: "MyStartup",
    stage: "mvp",
    industry: "fintech",
  }}
  showSteps={true}
/>

// Direct hook usage
import { useFredChat } from "@/lib/hooks/use-fred-chat";

const { messages, sendMessage, state, isProcessing } = useFredChat({
  context: { startupName: "MyStartup" },
  storeInMemory: true,
  onStateChange: (state) => console.log("State:", state),
});
```

---

*Plan created: 2026-02-05*
*Completed: 2026-02-05*
