---
phase: 17-founder-wellbeing
plan: 01
type: execute
wave: 2
depends_on:
  - 13-voice-core-ai-engines
files_modified:
  - lib/fred/actors/burnout-detector.ts
  - lib/fred/actors/validate-input.ts
  - lib/fred/types.ts
  - app/api/fred/chat/route.ts
  - lib/hooks/use-fred-chat.ts
  - app/dashboard/wellbeing/page.tsx
  - components/wellbeing/WellnessAssessment.tsx
  - components/wellbeing/BurnoutAlert.tsx
  - app/api/wellbeing/check-in/route.ts
autonomous: true

must_haves:
  truths:
    - "BurnoutSignals type is exported from lib/fred/types.ts with stress_level, indicators, and recommendation fields"
    - "burnout-detector actor analyzes user input text for burnout signals using keyword matching and sentiment analysis"
    - "validate-input actor includes burnoutSignals in ValidatedInput when burnout signals are detected"
    - "Chat route emits wellbeing SSE events when burnout signals exceed threshold"
    - "use-fred-chat hook handles wellbeing events and exposes wellbeingAlert state"
    - "Wellbeing check-in page at /dashboard/wellbeing provides a self-assessment form"
    - "WellnessAssessment component renders a multi-question assessment with scoring"
    - "BurnoutAlert component renders a dismissible alert banner when burnout is detected in chat"
    - "Check-in API persists assessment results and returns personalized recommendations"
  artifacts:
    - path: "lib/fred/actors/burnout-detector.ts"
      provides: "Burnout signal detection from user message text"
      exports: ["detectBurnoutSignals"]
    - path: "lib/fred/types.ts"
      provides: "BurnoutSignals type definition"
      contains: "BurnoutSignals"
    - path: "app/dashboard/wellbeing/page.tsx"
      provides: "Self-assessment check-in page for founder wellbeing"
    - path: "components/wellbeing/WellnessAssessment.tsx"
      provides: "Multi-question wellness assessment form component"
      exports: ["WellnessAssessment"]
    - path: "components/wellbeing/BurnoutAlert.tsx"
      provides: "Dismissible alert banner for burnout detection in chat"
      exports: ["BurnoutAlert"]
    - path: "app/api/wellbeing/check-in/route.ts"
      provides: "POST endpoint for persisting check-in results and returning recommendations"
  key_links:
    - from: "lib/fred/actors/burnout-detector.ts"
      to: "lib/fred/types.ts"
      via: "imports BurnoutSignals type"
      pattern: "import.*BurnoutSignals.*from.*types"
    - from: "lib/fred/actors/validate-input.ts"
      to: "lib/fred/actors/burnout-detector.ts"
      via: "calls detectBurnoutSignals() to enrich ValidatedInput"
      pattern: "detectBurnoutSignals"
    - from: "app/api/fred/chat/route.ts"
      to: "lib/fred/actors/burnout-detector.ts"
      via: "checks burnout signals and emits wellbeing SSE events"
      pattern: "wellbeing"
    - from: "app/dashboard/wellbeing/page.tsx"
      to: "components/wellbeing/WellnessAssessment.tsx"
      via: "renders WellnessAssessment component"
      pattern: "WellnessAssessment"
---

<objective>
Build burnout detection, a wellbeing check-in page, and a mindset coaching alert so FRED proactively supports founder mental health.

Purpose: Founder burnout is a leading cause of startup failure. FRED currently has no awareness of the founder's emotional state. This plan adds a burnout detection layer to the chat pipeline that identifies stress signals in conversation, a dedicated self-assessment check-in page where founders can evaluate their mental state, and an alert component that surfaces support when burnout is detected. All messaging uses Fred Cary's philosophy of grit, resilience, and honest mentorship.

Output: 3 new files (burnout detector, wellness assessment, burnout alert), 1 new page (wellbeing check-in), 1 new API route, 3 modified files (types, validate-input, chat route, use-fred-chat). No new npm dependencies.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

Key source files (READ ALL BEFORE MODIFYING):
@lib/fred/types.ts (existing FRED type definitions -- add BurnoutSignals here)
@lib/fred/actors/validate-input.ts (validates user input -- add burnout detection call)
@app/api/fred/chat/route.ts (SSE streaming -- add wellbeing event emission)
@lib/hooks/use-fred-chat.ts (client-side SSE handler -- add wellbeing event handling)
@lib/fred-brain.ts (Fred's philosophy principles for coaching content)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Detection engine and types</name>
  <files>
    lib/fred/types.ts
    lib/fred/actors/burnout-detector.ts
    lib/fred/actors/validate-input.ts
  </files>
  <action>
**Step 1: Add BurnoutSignals type to `lib/fred/types.ts`**

Add at the end of the file (do NOT modify existing types):

```typescript
// Founder Wellbeing Types
export interface BurnoutSignals {
  detected: boolean;
  stressLevel: number; // 0-100
  indicators: string[]; // e.g., ["sleep_issues", "overwhelm", "isolation"]
  recommendation: string; // brief supportive message
  suggestCheckIn: boolean; // whether to suggest the wellbeing page
}
```

**Step 2: Create `lib/fred/actors/burnout-detector.ts`**

Create a detection module that analyzes user message text for burnout signals.

Export `detectBurnoutSignals(text: string): BurnoutSignals`:
1. Define keyword groups for burnout indicators:
   - Sleep/exhaustion: "tired", "exhausted", "can't sleep", "no sleep", "burned out", "burnout", "drained"
   - Overwhelm: "overwhelmed", "too much", "drowning", "can't keep up", "falling behind", "buried"
   - Isolation: "alone", "no one understands", "isolated", "lonely", "no support"
   - Doubt: "giving up", "quit", "pointless", "waste of time", "not worth it", "failure", "failing"
   - Anxiety: "anxious", "worried", "panic", "stressed", "can't focus", "losing it"
2. Score each group 0-20 based on keyword matches (case-insensitive, word boundary matching)
3. Sum scores for stressLevel (0-100 scale)
4. Set detected = true if stressLevel >= 40
5. Set suggestCheckIn = true if stressLevel >= 60
6. Generate recommendation using Fred's voice:
   - stressLevel < 40: "" (no recommendation needed)
   - stressLevel 40-59: "I can tell things are weighing on you. That's normal -- building something from nothing is hard. Let's talk about what's really going on."
   - stressLevel 60-79: "Hey, I've been where you are. After 50+ years of this, I can tell you that burning out doesn't make you tougher -- it makes you worse at the job. Let's take a step back."
   - stressLevel >= 80: "I need you to hear this: your health matters more than your startup. I've watched too many founders destroy themselves. Let's check in on how you're really doing."

**Step 3: Wire into `lib/fred/actors/validate-input.ts`**

Import `detectBurnoutSignals` from `./burnout-detector`. Import `BurnoutSignals` from `@/lib/fred/types`.

In the validateInputActor function, after existing validation:
1. Call `detectBurnoutSignals(input.message)` (or equivalent user text field)
2. Attach the result as `burnoutSignals` on the ValidatedInput return object
3. Add `burnoutSignals?: BurnoutSignals` to the ValidatedInput type (or interface)

IMPORTANT: Do NOT modify any existing validation logic. Only ADD the burnout detection as an additional enrichment step.
  </action>
  <verify>
1. `grep 'BurnoutSignals' lib/fred/types.ts` -- type exists
2. `test -f lib/fred/actors/burnout-detector.ts` -- detector exists
3. `grep 'detectBurnoutSignals' lib/fred/actors/burnout-detector.ts` -- function exported
4. `grep 'burnoutSignals' lib/fred/actors/validate-input.ts` -- wired into validation
5. `npx tsc --noEmit` passes with no errors
  </verify>
  <done>
BurnoutSignals type added to lib/fred/types.ts. Burnout detector at lib/fred/actors/burnout-detector.ts analyzes text for 5 indicator groups and produces a 0-100 stress score with Fred-voiced recommendations. validate-input actor enriches ValidatedInput with burnoutSignals.
  </done>
</task>

<task type="auto">
  <name>Task 2: Check-in page and API</name>
  <files>
    app/dashboard/wellbeing/page.tsx
    components/wellbeing/WellnessAssessment.tsx
    app/api/wellbeing/check-in/route.ts
  </files>
  <action>
**Step 1: Create `components/wellbeing/WellnessAssessment.tsx`**

"use client" component with a multi-question self-assessment form:
- 5-7 questions covering: energy level, sleep quality, stress level, motivation, social connection, decision fatigue, work-life balance
- Each question uses a 1-5 Likert scale (radio buttons or slider)
- Questions styled as cards with Sahara orange accent
- Submit button triggers onComplete callback with scores
- Calculate overall wellness score (0-100) from responses
- Display result with color coding: green (70+), yellow (40-69), red (<40)
- Show personalized Fred recommendation based on score range

Props: `{ onComplete: (score: number, answers: Record<string, number>) => void }`

**Step 2: Create `app/dashboard/wellbeing/page.tsx`**

"use client" page at /dashboard/wellbeing:
- Page title: "Wellbeing Check-in" with subtitle referencing Fred's philosophy on founder health
- Render WellnessAssessment component
- On completion, POST results to /api/wellbeing/check-in
- Display returned recommendations in a results section
- Include a "Talk to Fred" link to /chat for follow-up conversation
- Include previous check-in history if available (fetch on mount from GET /api/wellbeing/check-in)
- Responsive layout consistent with dashboard styling

**Step 3: Create `app/api/wellbeing/check-in/route.ts`**

- POST: Authenticate user. Accept body with `{ score: number, answers: Record<string, number> }`. Store in profiles table or a new column (use upsert on profiles with a `wellbeing_last_score` and `wellbeing_last_check_in` field). Return personalized recommendations array based on score:
  - Score < 40: urgent recommendations (take a break, talk to someone, delegate)
  - Score 40-69: moderate recommendations (set boundaries, schedule rest, reassess priorities)
  - Score 70+: positive reinforcement (maintain routines, celebrate progress)
  All recommendations written in Fred's voice.

- GET: Authenticate user. Return last check-in score and date if available.
  </action>
  <verify>
1. `test -f components/wellbeing/WellnessAssessment.tsx` -- component exists
2. `test -f app/dashboard/wellbeing/page.tsx` -- page exists
3. `test -f app/api/wellbeing/check-in/route.ts` -- API exists
4. `grep 'onComplete' components/wellbeing/WellnessAssessment.tsx` -- callback prop present
5. `npx tsc --noEmit` passes with no errors
  </verify>
  <done>
WellnessAssessment component provides 5-7 question Likert assessment with scoring. Wellbeing page at /dashboard/wellbeing renders assessment and displays results. Check-in API persists scores and returns Fred-voiced recommendations.
  </done>
</task>

<task type="auto">
  <name>Task 3: Chat integration and alerts</name>
  <files>
    app/api/fred/chat/route.ts
    lib/hooks/use-fred-chat.ts
    components/wellbeing/BurnoutAlert.tsx
  </files>
  <action>
**Step 1: Create `components/wellbeing/BurnoutAlert.tsx`**

"use client" component that renders a dismissible alert banner:
- Props: `{ recommendation: string; suggestCheckIn: boolean; onDismiss: () => void }`
- Amber/yellow gradient banner with rounded corners and shadow
- Heart or shield icon (from lucide-react)
- Recommendation text in Fred's voice
- If suggestCheckIn is true, show a "Take a Wellbeing Check-in" link to /dashboard/wellbeing
- Dismiss X button that calls onDismiss
- Animate in with a gentle slide-down transition

**Step 2: Wire wellbeing events in `app/api/fred/chat/route.ts`**

After the validate-input step completes (which now includes burnoutSignals):
1. Check if `validatedInput.burnoutSignals?.detected` is true
2. If yes, emit an SSE event: `data: ${JSON.stringify({ type: "wellbeing", signals: validatedInput.burnoutSignals })}\n\n`
3. This should happen BEFORE the main response content, so the client can show the alert immediately

IMPORTANT: Do NOT block the main chat response. The wellbeing event is informational only. Do NOT modify the main response content or cognitive pipeline.

**Step 3: Handle wellbeing events in `lib/hooks/use-fred-chat.ts`**

Add handling for the `wellbeing` SSE event type:
1. Add state: `const [wellbeingAlert, setWellbeingAlert] = useState<BurnoutSignals | null>(null)`
2. When a `wellbeing` event is received, set the alert state
3. Export `wellbeingAlert` and a `dismissWellbeingAlert` callback from the hook's return value
4. The `dismissWellbeingAlert` callback sets wellbeingAlert to null

Import BurnoutSignals from `@/lib/fred/types`.

The chat interface component can then conditionally render BurnoutAlert when wellbeingAlert is non-null.
  </action>
  <verify>
1. `test -f components/wellbeing/BurnoutAlert.tsx` -- component exists
2. `grep 'wellbeing' app/api/fred/chat/route.ts` -- SSE event emitted
3. `grep 'wellbeingAlert' lib/hooks/use-fred-chat.ts` -- state tracked
4. `grep 'dismissWellbeingAlert' lib/hooks/use-fred-chat.ts` -- dismiss callback exported
5. `npx tsc --noEmit` passes with no errors
  </verify>
  <done>
BurnoutAlert component renders dismissible amber banner with Fred's recommendation and optional check-in link. Chat route emits wellbeing SSE events when burnout signals detected. use-fred-chat hook exposes wellbeingAlert state and dismissWellbeingAlert callback for chat UI integration.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Types compile:**
   ```bash
   grep 'BurnoutSignals' lib/fred/types.ts
   ```

2. **Detection works:**
   ```bash
   grep 'detectBurnoutSignals' lib/fred/actors/burnout-detector.ts lib/fred/actors/validate-input.ts
   ```

3. **Wellbeing page exists:**
   ```bash
   test -f app/dashboard/wellbeing/page.tsx && echo "EXISTS"
   ```

4. **API route exists:**
   ```bash
   test -f app/api/wellbeing/check-in/route.ts && echo "EXISTS"
   ```

5. **Chat integration wired:**
   ```bash
   grep 'wellbeing' app/api/fred/chat/route.ts lib/hooks/use-fred-chat.ts
   ```

6. **Alert component exists:**
   ```bash
   test -f components/wellbeing/BurnoutAlert.tsx && echo "EXISTS"
   ```

7. **TypeScript compiles:**
   ```bash
   npx tsc --noEmit
   ```
</verification>

<success_criteria>
- BurnoutSignals type exported from lib/fred/types.ts with stressLevel, indicators, recommendation, suggestCheckIn
- Burnout detector analyzes message text for 5 indicator groups and scores 0-100
- validate-input actor enriches ValidatedInput with burnoutSignals
- Chat route emits wellbeing SSE events when burnout signals detected (stressLevel >= 40)
- Wellbeing check-in page provides multi-question self-assessment at /dashboard/wellbeing
- Check-in API persists results and returns Fred-voiced recommendations
- BurnoutAlert renders dismissible alert with recommendation and optional check-in link
- use-fred-chat exposes wellbeingAlert state and dismiss callback
- All recommendations use Fred Cary's voice and philosophy
- No existing chat pipeline logic, scoring, or validation modified
- TypeScript compiles with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/17-founder-wellbeing/17-01-SUMMARY.md`
</output>
