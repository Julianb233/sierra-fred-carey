# Phase 33-01: Invite Acceptance Flow + Email Notifications

**Phase:** 33 — Collaboration & Sharing
**Plan:** 01 of 2
**Status:** PENDING
**Depends on:** None (core sharing + team management already built)

## Goal

The sharing and team management system is built (shareable links, team invites, role management, UI components). This plan completes the invite acceptance flow so invited users can actually accept team invitations, and adds email notifications for invites.

## Steps

### Step 1: Create invite acceptance API endpoint
**Files:** `app/api/team/accept/route.ts`
- POST: Accept a team invitation `{ inviteId: string }`
- Verify the authenticated user's email matches the invite's `member_email`
- Update team_members record: `status: "active"`, `member_user_id: userId`, `accepted_at: now()`
- Return the updated team membership
- Handle edge cases: already accepted, revoked invite, email mismatch

### Step 2: Create team invitations dashboard section
**Files:** `app/dashboard/invitations/page.tsx`
Create a page showing pending team invitations for the current user:
- Query `team_members` where `member_email = userEmail` and `status = "invited"`
- Show who invited them (owner name/email) and what role
- Accept button → calls POST `/api/team/accept`
- Decline button → calls DELETE `/api/team?id={inviteId}` (or PATCH to revoke)
- Show "No pending invitations" empty state
- Link from dashboard nav

### Step 3: Add invitation badge to dashboard nav
**Files:** Dashboard nav component
- Query pending invite count for current user
- Show badge on "Invitations" nav item when count > 0
- Refresh on page navigation

### Step 4: Add invite notification email (if Resend configured)
**Files:** `lib/email/invite.ts`
Create an email utility for team invites:
- `sendInviteEmail(toEmail, inviterName, role)` — sends invite notification
- Use Resend if `RESEND_API_KEY` is configured, otherwise no-op
- Email includes: inviter name, assigned role, CTA button linking to `/dashboard/invitations`
- Simple HTML template with Sahara branding

### Step 5: Trigger invite email on team member creation
**Files:** `app/api/team/route.ts`
In the POST handler (after creating the team member record):
- Call `sendInviteEmail()` fire-and-forget
- Don't block the API response on email delivery

## Verification

- [ ] POST `/api/team/accept` accepts invitations for matching email
- [ ] Invitations page shows pending invites with accept/decline
- [ ] Nav badge shows pending invite count
- [ ] Invite email sent when team member invited (if Resend configured)
- [ ] Email no-ops gracefully without RESEND_API_KEY
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run test` passes

## Files Changed

- `app/api/team/accept/route.ts` — new invite acceptance endpoint
- `app/dashboard/invitations/page.tsx` — new invitations management page
- Dashboard nav component — added invitation count badge
- `lib/email/invite.ts` — new invite email utility
- `app/api/team/route.ts` — trigger invite email on member creation
