# Phase 33-02: Team-Scoped Sharing + Sharing Analytics

**Phase:** 33 — Collaboration & Sharing
**Plan:** 02 of 2
**Status:** PENDING
**Depends on:** 33-01

## Goal

Add the ability to share documents specifically with team members (private shares) and create a sharing analytics dashboard showing link views and team activity.

## Steps

### Step 1: Add "Share with Team" option to ShareButton
**Files:** `components/sharing/share-button.tsx`
Extend the share dialog to include a team sharing mode:
- Toggle between "Public Link" and "Share with Team"
- "Share with Team" shows a list of active team members with checkboxes
- On share, create share links that are restricted to selected team members
- Add `team_member_ids` column to `shared_links` table (or use a junction table)

### Step 2: Create sharing migration for team-scoped links
**Files:** `lib/db/migrations/045_team_scoped_shares.sql`
- Add `is_team_only` boolean column to `shared_links` (default false)
- Create `shared_link_recipients` junction table: `shared_link_id`, `team_member_id`
- RLS policies for both owner and recipient access

### Step 3: Gate team-scoped shares in public viewer
**Files:** `app/shared/[token]/page.tsx` or `app/api/share/[token]/route.ts`
- If share link has `is_team_only = true`, verify the viewer is an active team member
- If not authenticated or not a team member, show "This link is restricted to team members"
- Public links continue to work as before

### Step 4: Create sharing analytics section
**Files:** `app/dashboard/settings/page.tsx` or new `app/dashboard/sharing/page.tsx`
Add a sharing analytics view:
- List all share links created by the user
- Show for each: resource type, created date, view count, expiry status, active/revoked
- Revoke button on each link
- Total shares count and total views

## Verification

- [ ] ShareButton has "Share with Team" mode
- [ ] Team-scoped shares verify team membership on access
- [ ] Sharing analytics shows link list with view counts
- [ ] Revoke button works from analytics view
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run test` passes

## Files Changed

- `components/sharing/share-button.tsx` — added team sharing mode
- `lib/db/migrations/045_team_scoped_shares.sql` — team-scoped sharing schema
- `app/shared/[token]/page.tsx` — team membership verification for restricted links
- Sharing analytics page — new link management and analytics view
