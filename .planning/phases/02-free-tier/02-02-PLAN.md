# Plan 02-02: FRED Chat Interface with Cognitive Framework

**Status:** COMPLETED
**Phase:** 02 - Free Tier Features
**Depends On:** 02-01 (Reality Lens - complete)
**Estimated Complexity:** Medium

---

## Objective

Upgrade the existing chat interface to use the new FRED cognitive API (`/api/fred/chat`) instead of the generic `/api/chat` endpoint. The UI should:
1. Connect to FRED's state machine-driven chat API
2. Show cognitive processing states (analyzing, applying mental models, synthesizing)
3. Display confidence levels and action recommendations
4. Store conversations in FRED's episodic memory

---

## Current State Analysis

**Existing:**
- `components/chat/chat-interface.tsx` - Basic chat UI, calls `/api/chat`
- `components/chat/chat-input.tsx` - Input component
- `components/chat/chat-message.tsx` - Message rendering
- `app/api/fred/chat/route.ts` - New FRED chat API (streaming + non-streaming)

**Problem:**
- UI uses old `/api/chat` endpoint
- No state visualization (INTAKE → VALIDATION → MENTAL_MODELS → SYNTHESIS → DECIDE)
- No confidence/action display

---

## Implementation Steps

### Step 1: Create FRED Chat Hook

**File:** `lib/hooks/use-fred-chat.ts`

```typescript
// Custom hook for FRED chat with SSE streaming
// Handles: connection, state updates, analysis events, final response
// Returns: messages, sendMessage, isProcessing, currentState, analysis
```

### Step 2: Update Chat Interface

**File:** `components/chat/chat-interface.tsx`

Changes:
1. Replace `/api/chat` with `useFredChat` hook
2. Add state indicator showing cognitive processing stage
3. Add optional "thinking" visualization during MENTAL_MODELS stage
4. Display confidence badge on assistant messages

### Step 3: Create Cognitive State Indicator

**File:** `components/chat/cognitive-state-indicator.tsx`

```typescript
// Shows current FRED processing state
// States: idle, analyzing, applying models, synthesizing, deciding
// Visual: progress dots or steps
```

### Step 4: Enhance Message Component

**File:** `components/chat/chat-message.tsx`

Add:
- Confidence badge (high/medium/low)
- Action pill if response suggests action
- Optional "View reasoning" expandable section

### Step 5: Add Session Management

**File:** `components/chat/chat-interface.tsx`

- Generate and persist sessionId across page reloads
- Use sessionStorage or context for session tracking
- Pass sessionId to FRED chat API

---

## Testing

- [x] Messages send and receive correctly
- [x] Streaming updates show cognitive states
- [x] Confidence levels display correctly
- [x] Session persists across refreshes
- [x] Error handling for API failures

---

## Verification

- [x] Chat UI connected to `/api/fred/chat`
- [x] Cognitive state indicator visible during processing
- [x] Confidence badges on responses
- [x] Session ID persisted and passed to API
- [x] Streaming responses work correctly

---

## Implementation Summary

**Files Created:**
- `lib/hooks/use-fred-chat.ts` - Custom hook for FRED chat with SSE streaming
- `components/chat/cognitive-state-indicator.tsx` - State indicator components (3 variants)

**Files Modified:**
- `components/chat/chat-message.tsx` - Added confidence badges, action pills, reasoning expander
- `components/chat/chat-interface.tsx` - Connected to useFredChat hook, added state indicators

---

*Plan completed: 2026-02-05*
