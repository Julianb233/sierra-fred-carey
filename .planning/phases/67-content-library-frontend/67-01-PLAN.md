---
phase: 67-content-library-frontend
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/dashboard/content/page.tsx
  - app/dashboard/content/[courseId]/page.tsx
  - app/dashboard/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Course catalog page exists at app/dashboard/content/page.tsx with filter UI and course grid"
    - "Course detail page exists at app/dashboard/content/[courseId]/page.tsx with module accordion"
    - "Content nav item added to dashboard sidebar in app/dashboard/layout.tsx"
    - "Empty state shown when no courses returned from API"
    - "Loading skeleton states shown while data fetches"
  artifacts:
    - path: "app/dashboard/content/page.tsx"
      provides: "Course catalog with stage/topic filters, grid of course cards, empty state"
      contains: "getCatalog\|/api/content"
    - path: "app/dashboard/content/[courseId]/page.tsx"
      provides: "Course detail with module accordion, lesson list, progress, enroll button"
      contains: "getCourse\|/api/content/"
    - path: "app/dashboard/layout.tsx"
      provides: "Content nav item in sidebar"
      contains: "Content\|/dashboard/content"
---

<objective>
Build the Course Catalog page and Course Detail page for the Sahara content library, plus add the Content nav item to the dashboard sidebar.

Purpose: Founders need to browse and enroll in courses. The catalog is the entry point; the detail page shows the module/lesson structure. Both pages use the existing GET /api/content and GET /api/content/[courseId] API routes built in Phase 66.
Output: Two Next.js pages with full loading/empty/error states, using the existing design system.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@lib/db/content.ts
@app/api/content/route.ts
@app/api/content/[courseId]/route.ts
@app/dashboard/layout.tsx
@app/dashboard/reality-lens/page.tsx
</context>

<tasks>

<task id="1" type="auto">
  <name>Add Content nav item to dashboard sidebar</name>
  <action>
Edit `app/dashboard/layout.tsx` to add a "Content" nav item to the `coreNavItems` array. Add it after "Coaching" (which links to /dashboard/coaching). Use the `BookOpen` icon from lucide-react (already available since lucide-react is installed).

Import `BookOpen` from "lucide-react" — it is already imported from lucide in the file, just add BookOpen to the destructured imports.

Insert after the Coaching entry:
```tsx
{
  name: "Content",
  href: "/dashboard/content",
  icon: <BookOpen className="h-4 w-4" />,
},
```

This is a core nav item (always visible to all tiers, since courses are free to browse).
  </action>
  <verify>
Run: `grep -n "Content\|BookOpen\|/dashboard/content" app/dashboard/layout.tsx`
Expected: shows BookOpen import, "Content" name, and "/dashboard/content" href.
  </verify>
  <done>layout.tsx has BookOpen imported and Content nav item pointing to /dashboard/content inserted after Coaching entry.</done>
</task>

<task id="2" type="auto">
  <name>Create Course Catalog page</name>
  <action>
Create `app/dashboard/content/page.tsx`.

This is a "use client" page (needs state for filters). It fetches from `/api/content` with optional stage and topic query params.

The page structure:
1. Header: "Content Library" title + subtitle "Learn from expert courses designed for founders at every stage."
2. Filter bar: two Select dropdowns — "All Stages" (idea/validation/growth/all) and "All Topics" (fundraising/product/growth/marketing/legal/operations/all). Filters trigger a refetch.
3. Course grid: responsive grid (1 col mobile, 2 col md, 3 col lg) of CourseCard components.
4. Empty state: when no courses, show a centered card with BookOpen icon, "Coming Soon" heading, "Our course library is being built. Check back soon." subtext, and a "Chat with FRED" button that links to /chat.
5. Loading state: show skeleton cards (use Skeleton from shadcn/ui).

CourseCard component (defined in the same file as a local component):
- Thumbnail: show img if thumbnail_url exists, otherwise a gradient placeholder (from-slate-700 to-slate-800)
- Title (font-semibold text-lg)
- Description (text-sm text-muted-foreground, line-clamp-2)
- Footer row: stage badge (Badge variant="secondary"), tier badge (if tier_required !== "free", show "Pro" or "Studio" Badge with variant="outline" and Lock icon)
- Duration: if any lessons have duration_seconds, compute total and show "Xh Ym" format
- The whole card is a Link to /dashboard/content/[course.id]

Type definitions needed at top of file:
```tsx
interface Course {
  id: string;
  title: string;
  description: string;
  slug: string;
  thumbnail_url: string | null;
  stage: string | null;
  topic: string | null;
  tier_required: "free" | "pro" | "studio";
  is_published: boolean;
  sort_order: number;
}
```

The fetch logic (use useEffect + useState):
```tsx
const [courses, setCourses] = useState<Course[]>([]);
const [loading, setLoading] = useState(true);
const [error, setError] = useState<string | null>(null);
const [stage, setStage] = useState<string>("all");
const [topic, setTopic] = useState<string>("all");

useEffect(() => {
  setLoading(true);
  const params = new URLSearchParams();
  if (stage !== "all") params.set("stage", stage);
  if (topic !== "all") params.set("topic", topic);
  fetch(`/api/content?${params}`)
    .then(r => r.json())
    .then(data => {
      setCourses(data.courses ?? []);
      setLoading(false);
    })
    .catch(() => {
      setError("Failed to load courses");
      setLoading(false);
    });
}, [stage, topic]);
```

Use Tailwind dark mode classes throughout (dark:bg-gray-900 etc). Follow the design aesthetic of the dashboard (white/dark card backgrounds, orange accent #ff6a1a for interactive elements).

Imports needed:
- useState, useEffect from react
- Link from next/link
- Badge from @/components/ui/badge
- Card, CardContent, CardFooter, CardHeader from @/components/ui/card
- Skeleton from @/components/ui/skeleton
- Select, SelectContent, SelectItem, SelectTrigger, SelectValue from @/components/ui/select
- Button from @/components/ui/button
- BookOpen, Lock from lucide-react
  </action>
  <verify>
Run: `ls app/dashboard/content/page.tsx && grep -c "use client" app/dashboard/content/page.tsx`
Expected: file exists and contains "use client".
Run: `grep -n "empty\|Coming\|skeleton\|Skeleton" app/dashboard/content/page.tsx`
Expected: shows empty state and skeleton handling.
  </verify>
  <done>app/dashboard/content/page.tsx exists with filter UI, course grid, CourseCard component, empty state, loading skeletons, and proper TypeScript types.</done>
</task>

<task id="3" type="auto">
  <name>Create Course Detail page</name>
  <action>
Create `app/dashboard/content/[courseId]/page.tsx`.

This is a "use client" page. It fetches from `/api/content/[courseId]`.

Type definitions:
```tsx
interface Lesson {
  id: string;
  module_id: string;
  title: string;
  description: string;
  sort_order: number;
  duration_seconds: number | null;
  mux_playback_id: string | null;
  mux_status: "pending" | "processing" | "ready" | "error";
  is_preview: boolean;
}

interface Module {
  id: string;
  course_id: string;
  title: string;
  description: string;
  sort_order: number;
  lessons: Lesson[];
}

interface Course {
  id: string;
  title: string;
  description: string;
  slug: string;
  thumbnail_url: string | null;
  stage: string | null;
  topic: string | null;
  tier_required: "free" | "pro" | "studio";
  modules: Module[];
}
```

Page props: `{ params: Promise<{ courseId: string }> }` (Next.js 15 async params).

Fetch logic:
```tsx
const resolvedParams = await use(params); // use React.use() to unwrap Promise params
```
Actually, for client components use `React.use(params)` to get courseId. OR simply use `useParams()` from next/navigation to get courseId — that's simpler.

Use `useParams()`:
```tsx
import { useParams } from "next/navigation";
const { courseId } = useParams() as { courseId: string };
```

Page structure:
1. Back link: "← Back to Content Library" (Link to /dashboard/content)
2. Course header card:
   - Thumbnail (if available) or gradient placeholder, displayed as a banner image
   - Title (text-2xl font-bold)
   - Description (text-muted-foreground)
   - Meta row: stage badge, tier badge, total lessons count, total duration
   - "Enroll" button (show as enrolled if user is enrolled — for now, a static button that shows "Enrolled" state in local state on click; actual enrollment API is in enrollments table but not wired in frontend yet — just POST to /api/content/progress with a dummy completed:false call as a stand-in is fine, OR just track enrollment in local state as this is MVP)
     - Button: onClick toggles enrolled state locally. "Enroll Now" → "Enrolled" with CheckCircle icon
3. Module accordion section:
   - Heading "Course Content"
   - For each module: an expandable section (use Accordion from shadcn/ui) with module title + lesson count in header
   - Inside accordion: list of lessons with:
     - Play icon (if mux_status === "ready") or Clock icon (if processing) or Lock icon (if not preview and tier > free and user not enrolled yet)
     - Lesson title
     - Duration formatted as "Xm Ys" or "—" if null
     - Link to /dashboard/content/[courseId]/lessons/[lesson.id] (only if mux_status === "ready")
4. Empty state for no modules: "No lessons yet. Content is being prepared."

Loading state: show a skeleton layout (two skeleton blocks for header, three for module list).
Error state: "Course not found" with back link.

Imports needed:
- useState, useEffect from react
- useParams from next/navigation
- Link from next/link
- Badge, Button, Card, CardContent, CardHeader, CardTitle, Skeleton from shadcn/ui
- Accordion, AccordionContent, AccordionItem, AccordionTrigger from @/components/ui/accordion
- Play, Clock, Lock, CheckCircle, ChevronLeft, BookOpen from lucide-react
  </action>
  <verify>
Run: `ls app/dashboard/content/[courseId]/page.tsx && grep -c "useParams\|courseId" app/dashboard/content/[courseId]/page.tsx`
Expected: file exists and references courseId and useParams.
  </verify>
  <done>app/dashboard/content/[courseId]/page.tsx exists with module accordion, lesson list with links, enroll button, loading skeletons, empty state, and proper TypeScript types.</done>
</task>

</tasks>

<verification>
1. `ls app/dashboard/content/page.tsx app/dashboard/content/[courseId]/page.tsx` — both files exist
2. `grep "BookOpen\|/dashboard/content" app/dashboard/layout.tsx` — Content nav item in layout
3. `grep -c "use client" app/dashboard/content/page.tsx app/dashboard/content/[courseId]/page.tsx` — both have use client
4. `npx tsc --noEmit 2>&1 | grep -i "content" | head -20` — no TypeScript errors in content pages
</verification>

<success_criteria>
- Content nav item visible in dashboard sidebar for all users
- Catalog page at /dashboard/content with filter UI, grid, empty state, loading skeletons
- Detail page at /dashboard/content/[courseId] with module accordion, lesson list, enroll button
- No TypeScript errors
- Pages follow existing design system (Tailwind, shadcn/ui, dark mode)
</success_criteria>

<output>
After completion, create `.planning/phases/67-content-library-frontend/67-01-SUMMARY.md` documenting what was built, decisions made, and any deviations.
</output>
