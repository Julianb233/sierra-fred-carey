---
milestone: v1.0
audited: 2026-02-06
status: tech_debt
scores:
  requirements: 16/17
  phases: 7/7
  integration: 26/28
  flows: 5/7
gaps:
  requirements: []
  integration:
    - from: "01-fred-engine"
      to: "02-free-tier"
      connection: "Chat interface → FRED cognitive engine"
      reason: "chat-interface.tsx calls /api/chat (legacy) instead of /api/fred/chat. FRED engine bypassed."
  flows:
    - name: "FRED Chat → Decision History"
      broken_at: "Chat endpoint"
      reason: "chat-interface.tsx calls /api/chat (legacy), not /api/fred/chat. No XState, no memory storage, no decisions in history."
    - name: "Dashboard CTA → Stripe Upgrade"
      broken_at: "Upgrade button"
      reason: "Dashboard page bottom CTA 'Upgrade Now' button has no onClick handler (dead button). Sidebar UpgradeBanner works correctly."
tech_debt:
  - phase: "02-free-tier"
    items:
      - "chat-interface.tsx calls /api/chat instead of /api/fred/chat — FRED cognitive engine bypassed [P0]"
      - "Reality Lens getUserTier() stub always returns 'free' — Pro/Studio users get wrong rate limits [P1]"
  - phase: "04-studio-tier"
    items:
      - "Nav 'Weekly Check-ins' links to /dashboard/check-ins (static mockup) not /dashboard/sms (functional) [P1]"
      - "/dashboard/check-ins is fully static mockup — no API calls, dead Save button [P2]"
  - phase: "general"
    items:
      - "Dashboard CTA 'Upgrade Now' button is dead (no onClick handler) [P1]"
      - "Dashboard stats and recent activity are hardcoded mocks [P2]"
      - "Legacy /dashboard/investor-score and /api/investor-score orphaned (not linked, but dead code) [P2]"
      - "Dual auth import pattern: @/lib/auth vs @/lib/supabase/auth-helpers (both resolve to same fn) [P2]"
---

# v1.0 Milestone Audit

**Project:** Sahara - AI-Powered Founder Operating System
**Milestone:** v1.0 MVP
**Audited:** 2026-02-06
**Status:** TECH DEBT (no critical blockers, 2 broken flows, accumulated minor issues)

---

## Scores

| Area | Score | Status |
|------|-------|--------|
| Requirements | 16/17 | 1 partial (chat wiring) |
| Phases | 7/7 | All complete + verified |
| Integration | 26/28 | 2 broken connections |
| E2E Flows | 5/7 | 2 broken |

---

## Phase Status

| Phase | Plans | Verified | Score | Status |
|-------|-------|----------|-------|--------|
| 01: FRED Cognitive Engine | 6 | Pre-verification | N/A | COMPLETE |
| 02: Free Tier Features | 5 | Pre-verification | N/A | COMPLETE |
| 03: Pro Tier Features | 7 | Yes | 11/11 | COMPLETE |
| 04: Studio Tier Features | 7 | Yes | 7/7 | COMPLETE |
| 05: Auth & Onboarding Fix | 2 | Yes (re-verified) | 6/6 | COMPLETE |
| 06: Tier Display & Stripe Wiring | 2 | Yes | 7/7 | COMPLETE |
| 07: Dashboard Integration | 2 | Yes | 7/7 | COMPLETE |

**Total:** 31 plans executed across 7 phases. 5 phases verified (38/38 must-haves passed).

---

## What Was Fixed This Session (Gap Closure)

The previous audit (2026-02-05) found 6 blockers and scored 11/17. Gap closure phases 05-07 addressed all of them:

| Previous Blocker | Resolution | Phase |
|-----------------|------------|-------|
| Supabase 500 on user creation | SQL migration applied via Management API, trigger + profiles table + tier column fixed | 05 |
| Random password on signup | Password field added to /get-started, /api/onboard requires password | 05 |
| No root middleware | proxy.ts created with session refresh + route protection | 05 |
| TierProvider not mounted | Mounted in providers.tsx, response shape fixed | 06 |
| Dashboard hardcoded user | Layout fetches real Supabase auth + profiles data | 06 |
| Stripe payment → tier update broken | Webhook → subscription → TierProvider → refreshTier() pipeline wired | 06 |
| Reality Lens calls legacy API | Rewired to /api/fred/reality-lens, legacy route deleted | 07 |
| Dashboard nav missing links | History + Investor Readiness links added/corrected | 07 |
| Email confirmation blocking signup | Disabled via Management API (mailer_autoconfirm: true) | 05 (infra) |

---

## Remaining Issues

### P0 — Must Fix Before Launch

**1. Chat interface calls wrong API endpoint**
- **File:** `components/chat/chat-interface.tsx` line 46
- **Issue:** Calls `/api/chat` (legacy) instead of `/api/fred/chat`
- **Impact:** The entire Phase 01 FRED cognitive engine (XState state machine, memory persistence, 7-factor scoring, streaming SSE) is bypassed for the primary chat experience. Conversations aren't stored in `fred_episodic_memory`, so Decision History shows nothing from chat.
- **Fix:** Use the existing `useFredChat` hook from `lib/hooks/use-fred-chat.ts` or change the fetch URL to `/api/fred/chat`

### P1 — Should Fix

**2. Dashboard CTA "Upgrade Now" is a dead button**
- **File:** `app/dashboard/page.tsx` lines 351-356
- **Issue:** `<Button>` has no `onClick` handler. Sidebar UpgradeBanner works correctly.
- **Fix:** Wrap in `<UpgradeTier>` dialog trigger or add `onClick` calling `redirectToCheckoutByTier()`

**3. Reality Lens `getUserTier()` is a hardcoded stub**
- **File:** `app/api/fred/reality-lens/route.ts` lines 44-48
- **Issue:** Always returns `"free"` — Pro/Studio users hit free-tier rate limits (5/day instead of 50/500)
- **Fix:** Call `getUserSubscription()` + `getPlanByPriceId()` + `getTierFromString()` like `lib/api/tier-middleware.ts`

**4. SMS nav points to static mockup instead of functional page**
- **File:** `app/dashboard/layout.tsx` line 113-118
- **Issue:** "Weekly Check-ins" nav item links to `/dashboard/check-ins` (fully static mockup) instead of `/dashboard/sms` (real API-connected page)
- **Fix:** Change nav href to `/dashboard/sms`, delete `/dashboard/check-ins` mockup page

### P2 — Minor / Cosmetic

**5. Dashboard stats are hardcoded mocks** — `app/dashboard/page.tsx` lines 118-202. Static values ("3", "1", "2", "4") and fake activity items.

**6. Legacy investor-score routes orphaned** — `/dashboard/investor-score/page.tsx` and `/api/investor-score/route.ts` still exist but aren't linked. Replaced by `/dashboard/investor-readiness` and `/api/fred/investor-readiness`.

**7. Dual auth import pattern** — `@/lib/auth` vs `@/lib/supabase/auth-helpers`. Both resolve to the same function, no functional impact.

---

## Infrastructure Status

| Component | Status | Notes |
|-----------|--------|-------|
| Supabase Auth | Working | Migration applied, trigger active, email confirmation disabled |
| Supabase Profiles Table | Working | All columns including tier, RLS enabled, 4 policies |
| Stripe Integration | Configured | Test keys in .env.local, webhook endpoint ready |
| Twilio | Configured | Lazy-init client, needs A2P 10DLC registration for production |
| AI Providers | Configured | Multi-provider with circuit breaker + fallback chain |
| Session Management | Working | proxy.ts refreshes on every request |

**Note:** `.env` contains template placeholders. `.env.local` contains real credentials and is used at runtime. This is standard Next.js practice.

---

## Requirements Coverage

| Requirement | Status | Phase | Notes |
|-------------|--------|-------|-------|
| FRED cognitive engine | Satisfied | 01 | State machine, scoring, memory, API endpoints |
| Multi-provider AI | Satisfied | 01 | Circuit breaker + fallback chain |
| Reality Lens | Satisfied | 02, 07 | FRED engine wired to dashboard |
| FRED chat | Partial | 02 | Engine exists but chat-interface.tsx calls legacy endpoint |
| Decision history | Satisfied | 02, 07 | UI + nav link working |
| Tier gating | Satisfied | 02, 06 | Server + client-side working |
| Onboarding | Satisfied | 02, 05 | Password collection, auth gate, session persistence |
| Auth system | Satisfied | 05 | Supabase signUp works, sessions refresh |
| PDF pipeline | Satisfied | 03 | Upload, extract, chunk, embed |
| Investor Readiness Score | Satisfied | 03 | Engine + API + UI + nav link |
| Pitch Deck Review | Satisfied | 03 | Slide-by-slide analysis + scoring |
| Strategy Documents | Satisfied | 03 | Generation + templates + UI components |
| Stripe Pro tier | Satisfied | 03, 06 | Checkout → webhook → TierProvider → UI |
| Virtual Agents | Satisfied | 04 | 3 agents + orchestrator + dashboard |
| SMS Check-ins | Satisfied | 04 | Twilio pipeline + templates + cron |
| Boardy Integration | Satisfied | 04 | Strategy pattern client + AI mock + dashboard |
| Studio Stripe tier | Satisfied | 04, 06 | Checkout + upgrade card + settings |

**Score:** 16/17 satisfied, 1 partial (FRED chat wiring)

---

## E2E Flow Analysis

| Flow | Status | Notes |
|------|--------|-------|
| 1. Signup → Dashboard | COMPLETE | /get-started → password → signUp → session → dashboard with real user |
| 2. Free → Pro Upgrade | COMPLETE | UpgradeBanner → Stripe checkout → webhook → TierProvider refresh (dashboard CTA button dead but sidebar works) |
| 3. FRED Chat → Decision | BROKEN | chat-interface.tsx calls /api/chat (legacy), FRED engine bypassed |
| 4. Reality Lens Assessment | COMPLETE | FRED engine → 5-factor assessment → dashboard rendering |
| 5. Pitch Deck Review | COMPLETE | PDF upload → analysis → slide-by-slide results |
| 6. Agent Dispatch | COMPLETE | Tier gate → dispatch → async execution → dashboard |
| 7. Dashboard Navigation | COMPLETE | All 15 sidebar links resolve to existing pages |

---

## Cross-Phase Integration (28 Verified)

- 26 exports correctly wired across phases
- 14 API routes have consumers
- 6 auth-protected areas verified
- 15 dashboard nav links → all pages exist
- 2 broken: chat endpoint (legacy vs FRED), dashboard CTA button (dead)

---

*Audit generated: 2026-02-06*
*Previous audit: 2026-02-05 (gaps_found, 11/17)*
*Integration checker: gsd-integration-checker agent*
